function ascendingComparator(t){return function(e,n){return ascending(t(e),n)}}function tickStep(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=e10?i*=10:o>=e5?i*=5:o>=e2&&(i*=2),e<t?-i:i}function length(t){return t.length}function Map(){}function map$1(t,e){var n=new Map;if(t instanceof Map)t.each(function(t,e){n.set(e,t)});else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)for(;++i<o;)n.set(i,t[i]);else for(;++i<o;)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}function createObject(){return{}}function setObject(t,e,n){t[e]=n}function createMap(){return map$1()}function setMap(t,e,n){t.set(e,n)}function Set(){}function set(t,e){var n=new Set;if(t instanceof Set)t.each(function(t){n.add(t)});else if(t){var r=-1,i=t.length;if(null==e)for(;++r<i;)n.add(t[r]);else for(;++r<i;)n.add(e(t[r],r,t))}return n}function FormatSpecifier(t){if(!(e=re.exec(t)))throw new Error("invalid format: "+t);var e,n=e[1]||" ",r=e[2]||">",i=e[3]||"-",o=e[4]||"",a=!!e[5],u=e[6]&&+e[6],s=!!e[7],l=e[8]&&+e[8].slice(1),c=e[9]||"";"n"===c?(s=!0,c="g"):formatTypes[c]||(c=""),(a||"0"===n&&"="===r)&&(a=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=o,this.zero=a,this.width=u,this.comma=s,this.precision=l,this.type=c}function identity$1(t){return t}function defaultLocale(t){return locale$1=formatLocale(t),format=locale$1.format,formatPrefix=locale$1.formatPrefix,locale$1}function extend(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Color(){}function color(t){var e;return t=(t+"").trim().toLowerCase(),(e=reHex3.exec(t))?(e=parseInt(e[1],16),new Rgb(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=reHex6.exec(t))?rgbn(parseInt(e[1],16)):(e=reRgbInteger.exec(t))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(t))?new Rgb(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=reRgbaInteger.exec(t))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(t))?rgba(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=reHslPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(t))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(t)?rgbn(named[t]):"transparent"===t?new Rgb(NaN,NaN,NaN,0):null}function rgbn(t){return new Rgb(t>>16&255,t>>8&255,255&t,1)}function rgba(t,e,n,r){return r<=0&&(t=e=n=NaN),new Rgb(t,e,n,r)}function rgbConvert(t){return t instanceof Color||(t=color(t)),t?(t=t.rgb(),new Rgb(t.r,t.g,t.b,t.opacity)):new Rgb}function rgb(t,e,n,r){return 1===arguments.length?rgbConvert(t):new Rgb(t,e,n,null==r?1:r)}function Rgb(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function hsla(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Hsl(t,e,n,r)}function hslConvert(t){if(t instanceof Hsl)return new Hsl(t.h,t.s,t.l,t.opacity);if(t instanceof Color||(t=color(t)),!t)return new Hsl;if(t instanceof Hsl)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,u=o-i,s=(o+i)/2;return u?(a=e===o?(n-r)/u+6*(n<r):n===o?(r-e)/u+2:(e-n)/u+4,u/=s<.5?o+i:2-o-i,a*=60):u=s>0&&s<1?0:a,new Hsl(a,u,s,t.opacity)}function hsl(t,e,n,r){return 1===arguments.length?hslConvert(t):new Hsl(t,e,n,null==r?1:r)}function Hsl(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function hsl2rgb(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function labConvert(t){if(t instanceof Lab)return new Lab(t.l,t.a,t.b,t.opacity);if(t instanceof Hcl){var e=t.h*deg2rad;return new Lab(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof Rgb||(t=rgbConvert(t));var n=rgb2xyz(t.r),r=rgb2xyz(t.g),i=rgb2xyz(t.b),o=xyz2lab((.4124564*n+.3575761*r+.1804375*i)/Xn),a=xyz2lab((.2126729*n+.7151522*r+.072175*i)/Yn),u=xyz2lab((.0193339*n+.119192*r+.9503041*i)/Zn);return new Lab(116*a-16,500*(o-a),200*(a-u),t.opacity)}function lab(t,e,n,r){return 1===arguments.length?labConvert(t):new Lab(t,e,n,null==r?1:r)}function Lab(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function rgb2xyz(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function hclConvert(t){if(t instanceof Hcl)return new Hcl(t.h,t.c,t.l,t.opacity);t instanceof Lab||(t=labConvert(t));var e=Math.atan2(t.b,t.a)*rad2deg;return new Hcl(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function hcl(t,e,n,r){return 1===arguments.length?hclConvert(t):new Hcl(t,e,n,null==r?1:r)}function Hcl(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function cubehelixConvert(t){if(t instanceof Cubehelix)return new Cubehelix(t.h,t.s,t.l,t.opacity);t instanceof Rgb||(t=rgbConvert(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(BC_DA*r+ED*e-EB*n)/(BC_DA+ED-EB),o=r-i,a=(E*(n-i)-C*o)/D,u=Math.sqrt(a*a+o*o)/(E*i*(1-i)),s=u?Math.atan2(a,o)*rad2deg-120:NaN;return new Cubehelix(s<0?s+360:s,u,i,t.opacity)}function cubehelix(t,e,n,r){return 1===arguments.length?cubehelixConvert(t):new Cubehelix(t,e,n,null==r?1:r)}function Cubehelix(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function basis(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function linear(t,e){return function(n){return t+n*e}}function exponential(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function hue(t,e){var n=e-t;return n?linear(t,n>180||n<-180?n-360*Math.round(n/360):n):constant$1(isNaN(t)?e:t)}function gamma(t){return 1===(t=+t)?nogamma:function(e,n){return n-e?exponential(e,n,t):constant$1(isNaN(e)?n:e)}}function nogamma(t,e){var n=e-t;return n?linear(t,n):constant$1(isNaN(t)?e:t)}function zero(t){return function(){return t}}function one(t){return function(e){return t(e)+""}}function cosh(t){return((t=Math.exp(t))+1/t)/2}function sinh(t){return((t=Math.exp(t))-1/t)/2}function tanh(t){return((t=Math.exp(2*t))-1)/(t+1)}function hcl$1(t){return function(e,n){var r=t((e=hcl(e)).h,(n=hcl(n)).h),i=nogamma(e.c,n.c),o=nogamma(e.l,n.l),a=nogamma(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}function cubehelix$1(t){return function e(n){function r(e,r){var i=t((e=cubehelix(e)).h,(r=cubehelix(r)).h),o=nogamma(e.s,r.s),a=nogamma(e.l,r.l),u=nogamma(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=u(t),e+""}}return n=+n,r.gamma=e,r}(1)}function dispatch(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new Dispatch(r)}function Dispatch(t){this._=t}function parseTypenames(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}function get(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function set$2(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=noop,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}function fixCallback(t){return function(e,n){t(null==e?n:null)}}function hasResponse(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function objectConverter(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}function customConverter(t,e){var n=objectConverter(t);return function(r,i){return e(n(r),i,t)}}function inferColumns(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}function responseOf(t,e){return function(n){return t(n.responseText,e)}}function ordinal(t){function e(e){var o=e+"",a=n.get(o);if(!a){if(i!==implicit)return i;n.set(o,a=r.push(e))}return t[(a-1)%t.length]}var n=map$1(),r=[],i=implicit;return t=null==t?[]:slice$1.call(t),e.domain=function(t){if(!arguments.length)return r.slice();r=[],n=map$1();for(var i,o,a=-1,u=t.length;++a<u;)n.has(o=(i=t[a])+"")||n.set(o,r.push(i));return e},e.range=function(n){return arguments.length?(t=slice$1.call(n),e):t.slice()},e.unknown=function(t){return arguments.length?(i=t,e):i},e.copy=function(){return ordinal().domain(r).range(t).unknown(i)},e}function band(){function t(){var t=i().length,r=a[1]<a[0],h=a[r-0],f=a[1-r];e=(f-h)/Math.max(1,t-s+2*l),u&&(e=Math.floor(e)),h+=(f-h-e*(t-s))*c,n=e*(1-s),u&&(h=Math.round(h),n=Math.round(n));var m=sequence(t).map(function(t){return h+e*t});return o(r?m.reverse():m)}var e,n,r=ordinal().unknown(void 0),i=r.domain,o=r.range,a=[0,1],u=!1,s=0,l=0,c=.5;return delete r.unknown,r.domain=function(e){return arguments.length?(i(e),t()):i()},r.range=function(e){return arguments.length?(a=[+e[0],+e[1]],t()):a.slice()},r.rangeRound=function(e){return a=[+e[0],+e[1]],u=!0,t()},r.bandwidth=function(){return n},r.step=function(){return e},r.round=function(e){return arguments.length?(u=!!e,t()):u},r.padding=function(e){return arguments.length?(s=l=Math.max(0,Math.min(1,e)),t()):s},r.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),t()):s},r.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),t()):l},r.align=function(e){return arguments.length?(c=Math.max(0,Math.min(1,e)),t()):c},r.copy=function(){return band().domain(i()).range(a).round(u).paddingInner(s).paddingOuter(l).align(c)},t()}function pointish(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return pointish(e())},t}function deinterpolateLinear(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:constant$2(e)}function deinterpolateClamp(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=e?0:t>=n?1:r(t)}}}function reinterpolateClamp(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=0?e:t>=1?n:r(t)}}}function bimap(t,e,n,r){var i=t[0],o=t[1],a=e[0],u=e[1];return o<i?(i=n(o,i),a=r(u,a)):(i=n(i,o),a=r(a,u)),function(t){return a(i(t))}}function polymap(t,e,n,r){var i=Math.min(t.length,e.length)-1,o=new Array(i),a=new Array(i),u=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++u<i;)o[u]=n(t[u],t[u+1]),a[u]=r(e[u],e[u+1]);return function(e){var n=bisectRight(t,e,1,i)-1;return a[n](o[n](e))}}function copy(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp())}function continuous(t,e){function n(){return i=Math.min(u.length,s.length)>2?polymap:bimap,o=a=null,r}function r(e){return(o||(o=i(u,s,c?deinterpolateClamp(t):t,l)))(+e)}var i,o,a,u=unit,s=unit,l=interpolateValue,c=!1;return r.invert=function(t){return(a||(a=i(s,u,deinterpolateLinear,c?reinterpolateClamp(e):e)))(+t)},r.domain=function(t){return arguments.length?(u=map$3.call(t,number$1),n()):u.slice()},r.range=function(t){return arguments.length?(s=slice$1.call(t),n()):s.slice()},r.rangeRound=function(t){return s=slice$1.call(t),l=interpolateRound,n()},r.clamp=function(t){return arguments.length?(c=!!t,n()):c},r.interpolate=function(t){return arguments.length?(l=t,n()):l},n()}function linearish(t){var e=t.domain;return t.ticks=function(t){var n=e();return ticks(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){return tickFormat(e(),t,n)},t.nice=function(n){var r=e(),i=r.length-1,o=null==n?10:n,a=r[0],u=r[i],s=tickStep(a,u,o);return s&&(s=tickStep(Math.floor(a/s)*s,Math.ceil(u/s)*s,o),r[0]=Math.floor(a/s)*s,r[i]=Math.ceil(u/s)*s,e(r)),t},t}function linear$1(){var t=continuous(deinterpolateLinear,reinterpolate);return t.copy=function(){return copy(t,linear$1())},linearish(t)}function identity$3(){function t(t){return+t}var e=[0,1];return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map$3.call(n,number$1),t):e.slice()},t.copy=function(){return identity$3().domain(e)},linearish(t)}function deinterpolate(t,e){return(e=Math.log(e/t))?function(n){return Math.log(n/t)/e}:constant$2(e)}function reinterpolate$1(t,e){return t<0?function(n){return-Math.pow(-e,n)*Math.pow(-t,1-n)}:function(n){return Math.pow(e,n)*Math.pow(t,1-n)}}function pow10(t){return isFinite(t)?+("1e"+t):t<0?0:t}function powp(t){return 10===t?pow10:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}function logp(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}function reflect(t){return function(e){return-t(-e)}}function log(){function t(){return i=logp(r),o=powp(r),n()[0]<0&&(i=reflect(i),o=reflect(o)),e}var e=continuous(deinterpolate,reinterpolate$1).domain([1,10]),n=e.domain,r=10,i=logp(10),o=powp(10);return e.base=function(e){return arguments.length?(r=+e,t()):r},e.domain=function(e){return arguments.length?(n(e),t()):n()},e.ticks=function(t){var e,a=n(),u=a[0],s=a[a.length-1];(e=s<u)&&(f=u,u=s,s=f);var l,c,h,f=i(u),m=i(s),d=null==t?10:+t,g=[];if(!(r%1)&&m-f<d){if(f=Math.round(f)-1,m=Math.round(m)+1,u>0){for(;f<m;++f)for(c=1,l=o(f);c<r;++c)if(h=l*c,!(h<u)){if(h>s)break;g.push(h)}}else for(;f<m;++f)for(c=r-1,l=o(f);c>=1;--c)if(h=l*c,!(h<u)){if(h>s)break;g.push(h)}}else g=ticks(f,m,Math.min(m-f,d)).map(o);return e?g.reverse():g},e.tickFormat=function(t,n){if(null==n&&(n=10===r?".0e":","),"function"!=typeof n&&(n=format(n)),t===1/0)return n;null==t&&(t=10);var a=Math.max(1,r*t/e.ticks().length);return function(t){var e=t/o(Math.round(i(t)));return e*r<r-.5&&(e*=r),e<=a?n(t):""}},e.nice=function(){return n(nice(n(),{floor:function(t){return o(Math.floor(i(t)))},ceil:function(t){return o(Math.ceil(i(t)))}}))},e.copy=function(){return copy(e,log().base(r))},e}function raise(t,e){return t<0?-Math.pow(-t,e):Math.pow(t,e)}function pow(){function t(t,e){return(e=raise(e,n)-(t=raise(t,n)))?function(r){return(raise(r,n)-t)/e}:constant$2(e)}function e(t,e){return e=raise(e,n)-(t=raise(t,n)),function(r){return raise(t+e*r,1/n)}}var n=1,r=continuous(t,e),i=r.domain;return r.exponent=function(t){return arguments.length?(n=+t,i(i())):n},r.copy=function(){return copy(r,pow().exponent(n))},linearish(r)}function quantile$$1(){function t(){var t=0,o=Math.max(1,r.length);for(i=new Array(o-1);++t<o;)i[t-1]=threshold(n,t/o);return e}function e(t){if(!isNaN(t=+t))return r[bisectRight(i,t)]}var n=[],r=[],i=[];return e.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},e.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var r,i=0,o=e.length;i<o;++i)r=e[i],null==r||isNaN(r=+r)||n.push(r);return n.sort(ascending),t()},e.range=function(e){return arguments.length?(r=slice$1.call(e),t()):r.slice()},e.quantiles=function(){return i.slice()},e.copy=function(){return quantile$$1().domain(n).range(r)},e}function quantize$1(){function t(t){if(t<=t)return a[bisectRight(o,t,0,i)]}function e(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return t}var n=0,r=1,i=1,o=[.5],a=[0,1];return t.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],e()):[n,r]},t.range=function(t){return arguments.length?(i=(a=slice$1.call(t)).length-1,e()):a.slice()},t.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},t.copy=function(){return quantize$1().domain([n,r]).range(a)},linearish(t)}function threshold$1(){function t(t){if(t<=t)return n[bisectRight(e,t,0,r)]}var e=[.5],n=[0,1],r=1;return t.domain=function(i){return arguments.length?(e=slice$1.call(i),r=Math.min(e.length,n.length-1),t):e.slice()},t.range=function(i){return arguments.length?(n=slice$1.call(i),r=Math.min(e.length,n.length-1),t):n.slice()},t.invertExtent=function(t){var r=n.indexOf(t);return[e[r-1],e[r]]},t.copy=function(){return threshold$1().domain(e).range(n)},t}function newInterval(t,e,n,r){function i(e){return t(e=new Date(+e)),e}return i.floor=i,i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return a;do a.push(new Date(+n));while(e(n,o),t(n),n<r);return a},i.filter=function(n){return newInterval(function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},function(t,r){if(t>=t)for(;--r>=0;)for(;e(t,1),!n(t););})},n&&(i.count=function(e,r){return t0$1.setTime(+e),t1$1.setTime(+r),t(t0$1),t(t1$1),Math.floor(n(t0$1,t1$1))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t===0}:function(e){return i.count(0,e)%t===0}):i:null}),i}function weekday(t){return newInterval(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*durationMinute$1)/durationWeek$1})}function utcWeekday(t){return newInterval(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/durationWeek$1})}function localDate(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function utcDate(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function newYear(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale$1(t){function e(t,e){return function(n){var r,i,o,a=[],u=-1,s=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++u<l;)37===t.charCodeAt(u)&&(a.push(t.slice(s,u)),null!=(i=pads[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),s=u+1);return a.push(t.slice(s,u)),a.join("")}}function n(t,e){return function(n){var i=newYear(1900),o=r(i,t,n+="",0);if(o!=n.length)return null;if("p"in i&&(i.H=i.H%12+12*i.p),"W"in i||"U"in i){"w"in i||(i.w="W"in i?1:0);var a="Z"in i?utcDate(newYear(i.y)).getUTCDay():e(newYear(i.y)).getDay();i.m=0,i.d="W"in i?(i.w+6)%7+7*i.W-(a+5)%7:i.w+7*i.U-(a+6)%7}return"Z"in i?(i.H+=i.Z/100|0,i.M+=i.Z%100,utcDate(i)):e(i)}}function r(t,e,n,r){for(var i,o,a=0,u=e.length,s=n.length;a<u;){if(r>=s)return-1;if(i=e.charCodeAt(a++),37===i){if(i=e.charAt(a++),o=W[i in pads?e.charAt(a++):i],!o||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function i(t,e,n){var r=L.exec(e.slice(n));return r?(t.p=A[r[0].toLowerCase()],n+r[0].length):-1}function o(t,e,n){var r=R.exec(e.slice(n));return r?(t.w=$[r[0].toLowerCase()],n+r[0].length):-1}function a(t,e,n){var r=F.exec(e.slice(n));return r?(t.w=P[r[0].toLowerCase()],n+r[0].length):-1}function u(t,e,n){var r=I.exec(e.slice(n));return r?(t.m=Y[r[0].toLowerCase()],n+r[0].length):-1}function s(t,e,n){var r=H.exec(e.slice(n));return r?(t.m=E[r[0].toLowerCase()],n+r[0].length):-1}function l(t,e,n){return r(t,M,e,n)}function c(t,e,n){return r(t,x,e,n)}function h(t,e,n){return r(t,_,e,n)}function f(t){return C[t.getDay()]}function m(t){return k[t.getDay()]}function d(t){return S[t.getMonth()]}function g(t){return N[t.getMonth()]}function p(t){return T[+(t.getHours()>=12)]}function y(t){return C[t.getUTCDay()]}function b(t){return k[t.getUTCDay()]}function v(t){return S[t.getUTCMonth()]}function w(t){return N[t.getUTCMonth()]}function D(t){return T[+(t.getUTCHours()>=12)]}var M=t.dateTime,x=t.date,_=t.time,T=t.periods,k=t.days,C=t.shortDays,N=t.months,S=t.shortMonths,L=formatRe(T),A=formatLookup(T),F=formatRe(k),P=formatLookup(k),R=formatRe(C),$=formatLookup(C),H=formatRe(N),E=formatLookup(N),I=formatRe(S),Y=formatLookup(S),O={a:f,A:m,b:d,B:g,c:null,d:formatDayOfMonth,e:formatDayOfMonth,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:p,S:formatSeconds,U:formatWeekNumberSunday,w:formatWeekdayNumber,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},U={a:y,A:b,b:v,B:w,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:D,S:formatUTCSeconds,U:formatUTCWeekNumberSunday,w:formatUTCWeekdayNumber,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},W={a:o,A:a,b:u,B:s,c:l,d:parseDayOfMonth,e:parseDayOfMonth,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:i,S:parseSeconds,U:parseWeekNumberSunday,w:parseWeekdayNumber,W:parseWeekNumberMonday,x:c,X:h,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};return O.x=e(x,O),O.X=e(_,O),O.c=e(M,O),U.x=e(x,U),U.X=e(_,U),U.c=e(M,U),{format:function(t){var n=e(t+="",O);return n.toString=function(){return t},n},parse:function(t){var e=n(t+="",localDate);return e.toString=function(){return t},e},utcFormat:function(t){var n=e(t+="",U);return n.toString=function(){return t},n},utcParse:function(t){var e=n(t,utcDate);return e.toString=function(){return t},e}}}function pad(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function requote(t){return t.replace(requoteRe,"\\$&")}function formatRe(t){return new RegExp("^(?:"+t.map(requote).join("|")+")","i")}function formatLookup(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function parseWeekdayNumber(t,e,n){var r=numberRe.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function parseWeekNumberSunday(t,e,n){var r=numberRe.exec(e.slice(n));return r?(t.U=+r[0],n+r[0].length):-1}function parseWeekNumberMonday(t,e,n){var r=numberRe.exec(e.slice(n));return r?(t.W=+r[0],n+r[0].length):-1}function parseFullYear(t,e,n){var r=numberRe.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function parseYear(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function parseZone(t,e,n){var r=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function parseMonthNumber(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function parseDayOfMonth(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function parseDayOfYear(t,e,n){var r=numberRe.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function parseHour24(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function parseMinutes(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function parseSeconds(t,e,n){var r=numberRe.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function parseMilliseconds(t,e,n){var r=numberRe.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function parseLiteralPercent(t,e,n){var r=percentRe.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function formatDayOfMonth(t,e){return pad(t.getDate(),e,2)}function formatHour24(t,e){return pad(t.getHours(),e,2)}function formatHour12(t,e){return pad(t.getHours()%12||12,e,2)}function formatDayOfYear(t,e){return pad(1+day.count(year(t),t),e,3)}function formatMilliseconds(t,e){return pad(t.getMilliseconds(),e,3)}function formatMonthNumber(t,e){return pad(t.getMonth()+1,e,2)}function formatMinutes(t,e){return pad(t.getMinutes(),e,2)}function formatSeconds(t,e){return pad(t.getSeconds(),e,2)}function formatWeekNumberSunday(t,e){return pad(sunday.count(year(t),t),e,2)}function formatWeekdayNumber(t){return t.getDay()}function formatWeekNumberMonday(t,e){return pad(monday.count(year(t),t),e,2)}function formatYear(t,e){return pad(t.getFullYear()%100,e,2)}function formatFullYear(t,e){return pad(t.getFullYear()%1e4,e,4)}function formatZone(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+pad(e/60|0,"0",2)+pad(e%60,"0",2)}function formatUTCDayOfMonth(t,e){return pad(t.getUTCDate(),e,2)}function formatUTCHour24(t,e){return pad(t.getUTCHours(),e,2)}function formatUTCHour12(t,e){return pad(t.getUTCHours()%12||12,e,2)}function formatUTCDayOfYear(t,e){return pad(1+utcDay.count(utcYear(t),t),e,3)}function formatUTCMilliseconds(t,e){return pad(t.getUTCMilliseconds(),e,3)}function formatUTCMonthNumber(t,e){return pad(t.getUTCMonth()+1,e,2)}function formatUTCMinutes(t,e){return pad(t.getUTCMinutes(),e,2)}function formatUTCSeconds(t,e){return pad(t.getUTCSeconds(),e,2)}function formatUTCWeekNumberSunday(t,e){return pad(utcSunday.count(utcYear(t),t),e,2)}function formatUTCWeekdayNumber(t){return t.getUTCDay()}function formatUTCWeekNumberMonday(t,e){return pad(utcMonday.count(utcYear(t),t),e,2)}function formatUTCYear(t,e){return pad(t.getUTCFullYear()%100,e,2)}function formatUTCFullYear(t,e){return pad(t.getUTCFullYear()%1e4,e,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function defaultLocale$1(t){return locale$2=formatLocale$1(t),timeFormat=locale$2.format,timeParse=locale$2.parse,utcFormat=locale$2.utcFormat,utcParse=locale$2.utcParse,locale$2}function formatIsoNative(t){return t.toISOString()}function parseIsoNative(t){var e=new Date(t);return isNaN(e)?null:e}function date$1(t){return new Date(t)}function number$2(t){return t instanceof Date?+t:+new Date(+t)}function calendar(t,e,n,r,i,o,a,u,s){function l(u){return(a(u)<u?d:o(u)<u?g:i(u)<u?p:r(u)<u?y:e(u)<u?n(u)<u?b:v:t(u)<u?w:D)(u)}function c(e,n,r,i){if(null==e&&(e=10),"number"==typeof e){var o=Math.abs(r-n)/e,a=bisector(function(t){return t[2]}).right(M,o);a===M.length?(i=tickStep(n/durationYear,r/durationYear,e),e=t):a?(a=M[o/M[a-1][2]<M[a][2]/o?a-1:a],i=a[1],e=a[0]):(i=tickStep(n,r,e),e=u)}return null==i?e:e.every(i)}var h=continuous(deinterpolateLinear,reinterpolate),f=h.invert,m=h.domain,d=s(".%L"),g=s(":%S"),p=s("%I:%M"),y=s("%I %p"),b=s("%a %d"),v=s("%b %d"),w=s("%B"),D=s("%Y"),M=[[a,1,durationSecond],[a,5,5*durationSecond],[a,15,15*durationSecond],[a,30,30*durationSecond],[o,1,durationMinute],[o,5,5*durationMinute],[o,15,15*durationMinute],[o,30,30*durationMinute],[i,1,durationHour],[i,3,3*durationHour],[i,6,6*durationHour],[i,12,12*durationHour],[r,1,durationDay],[r,2,2*durationDay],[n,1,durationWeek],[e,1,durationMonth],[e,3,3*durationMonth],[t,1,durationYear]];return h.invert=function(t){return new Date(f(t))},h.domain=function(t){return arguments.length?m(map$3.call(t,number$2)):m().map(date$1)},h.ticks=function(t,e){var n,r=m(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=c(t,i,o,e),n=n?n.range(i,o+1):[],a?n.reverse():n},h.tickFormat=function(t,e){return null==e?l:s(e)},h.nice=function(t,e){var n=m();return(t=c(t,n[0],n[n.length-1],e))?m(nice(n,t)):h},h.copy=function(){return copy(h,calendar(t,e,n,r,i,o,a,u,s))},h}function sequential(t){function e(e){var o=(e-n)/(r-n);return t(i?Math.max(0,Math.min(1,o)):o)}var n=0,r=1,i=!1;return e.domain=function(t){return arguments.length?(n=+t[0],r=+t[1],e):[n,r]},e.clamp=function(t){return arguments.length?(i=!!t,e):i},e.interpolator=function(n){return arguments.length?(t=n,e):t},e.copy=function(){return sequential(t).domain([n,r]).clamp(i)},linearish(e)}function creatorInherit(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(t):e.createElementNS(n,t)}}function creatorFixed(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function filterContextListener(t,e,n){return t=contextListener(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function contextListener(t,e,n){return function(r){var i=event;event=r;try{t.call(this,this.__data__,e,n)}finally{event=i}}}function parseTypenames$1(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function onRemove(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function onAdd(t,e,n){var r=filterEvents.hasOwnProperty(t.type)?filterContextListener:contextListener;return function(i,o,a){var u,s=this.__on,l=r(e,o,a);if(s)for(var c=0,h=s.length;c<h;++c)if((u=s[c]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=n),void(u.value=e);this.addEventListener(t.type,l,n),u={type:t.type,name:t.name,value:e,listener:l,capture:n},s?s.push(u):this.__on=[u]}}function none(){}function empty(){return[]}function EnterNode(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function bindIndex(t,e,n,r,i,o){for(var a,u=0,s=e.length,l=o.length;u<l;++u)(a=e[u])?(a.__data__=o[u],r[u]=a):n[u]=new EnterNode(t,o[u]);for(;u<s;++u)(a=e[u])&&(i[u]=a)}function bindKey(t,e,n,r,i,o,a){var u,s,l,c={},h=e.length,f=o.length,m=new Array(h);for(u=0;u<h;++u)(s=e[u])&&(m[u]=l=keyPrefix+a.call(s,s.__data__,u,e),l in c?i[u]=s:c[l]=s);for(u=0;u<f;++u)l=keyPrefix+a.call(t,o[u],u,o),(s=c[l])?(r[u]=s,s.__data__=o[u],c[l]=null):n[u]=new EnterNode(t,o[u]);for(u=0;u<h;++u)(s=e[u])&&c[m[u]]===s&&(i[u]=s)}function ascending$1(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function attrRemove(t){return function(){this.removeAttribute(t)}}function attrRemoveNS(t){return function(){this.removeAttributeNS(t.space,t.local)}}function attrConstant(t,e){return function(){this.setAttribute(t,e)}}function attrConstantNS(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function attrFunction(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function attrFunctionNS(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function styleRemove(t){return function(){this.style.removeProperty(t)}}function styleConstant(t,e,n){return function(){this.style.setProperty(t,e,n)}}function styleFunction(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function propertyRemove(t){return function(){delete this[t]}}function propertyConstant(t,e){return function(){this[t]=e}}function propertyFunction(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function classArray(t){return t.trim().split(/^|\s+/)}function classList(t){return t.classList||new ClassList(t)}function ClassList(t){this._node=t,this._names=classArray(t.getAttribute("class")||"")}function classedAdd(t,e){for(var n=classList(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function classedRemove(t,e){for(var n=classList(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function classedTrue(t){return function(){classedAdd(this,t)}}function classedFalse(t){return function(){classedRemove(this,t)}}function classedFunction(t,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,t)}}function textRemove(){this.textContent=""}function textConstant(t){return function(){this.textContent=t}}function textFunction(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function htmlRemove(){this.innerHTML=""}function htmlConstant(t){return function(){this.innerHTML=t}}function htmlFunction(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function raise$1(){this.nextSibling&&this.parentNode.appendChild(this)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function constantNull(){return null}function remove(){var t=this.parentNode;t&&t.removeChild(this)}function dispatchEvent(t,e,n){var r=defaultView(t),i=r.CustomEvent;i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),
t.dispatchEvent(i)}function dispatchConstant(t,e){return function(){return dispatchEvent(this,t,e)}}function dispatchFunction(t,e){return function(){return dispatchEvent(this,t,e.apply(this,arguments))}}function Selection(t,e){this._groups=t,this._parents=e}function selection(){return new Selection([[document.documentElement]],root)}function mergeRecursive(t,e){"use strict";for(var n in e)try{e[n].constructor===Object?t[n]=mergeRecursive(t[n],e[n]):t[n]=e[n]}catch(r){t[n]=e[n]}return t}function arrayEquals(t,e){"use strict";if(!e||!t)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!arrayEquals(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}var ascending=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},bisector=function(t){return 1===t.length&&(t=ascendingComparator(t)),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}},ascendingBisect=bisector(ascending),bisectRight=ascendingBisect.right,number=function(t){return null===t?NaN:+t},extent=function(t,e){var n,r,i,o=-1,a=t.length;if(null==e){for(;++o<a;)if(null!=(r=t[o])&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=t[o])&&(n>r&&(n=r),i<r&&(i=r))}else{for(;++o<a;)if(null!=(r=e(t[o],o,t))&&r>=r){n=i=r;break}for(;++o<a;)null!=(r=e(t[o],o,t))&&(n>r&&(n=r),i<r&&(i=r))}return[n,i]},array=Array.prototype,slice=array.slice,map=array.map,constant=function(t){return function(){return t}},identity=function(t){return t},sequence=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o},e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2),ticks=function(t,e,n){var r=tickStep(t,e,n);return sequence(Math.ceil(t/r)*r,Math.floor(e/r)*r+r/2,r)},sturges=function(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1},threshold=function(t,e,n){if(null==n&&(n=number),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t),u=+n(t[o+1],o+1,t);return a+(u-a)*(i-o)}},max=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&r>n&&(n=r)}return n},min=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&n>r&&(n=r)}return n},prefix="$";Map.prototype=map$1.prototype={constructor:Map,has:function(t){return prefix+t in this},get:function(t){return this[prefix+t]},set:function(t,e){return this[prefix+t]=e,this},remove:function(t){var e=prefix+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===prefix&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===prefix&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===prefix&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===prefix&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===prefix&&++t;return t},empty:function(){for(var t in this)if(t[0]===prefix)return!1;return!0},each:function(t){for(var e in this)e[0]===prefix&&t(this[e],e.slice(1),this)}};var proto=map$1.prototype;Set.prototype=set.prototype={constructor:Set,has:proto.has,add:function(t){return t+="",this[prefix+t]=t,this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};var prefixExponent,formatDecimal=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},exponent=function(t){return t=formatDecimal(Math.abs(t)),t?t[1]:NaN},formatGroup=function(t,e){return function(n,r){for(var i=n.length,o=[],a=0,u=t[0],s=0;i>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),o.push(n.substring(i-=u,i+u)),!((s+=u+1)>r));)u=t[a=(a+1)%t.length];return o.reverse().join(e)}},formatDefault=function(t,e){t=t.toPrecision(e);t:for(var n,r=t.length,i=1,o=-1;i<r;++i)switch(t[i]){case".":o=n=i;break;case"0":0===o&&(o=i),n=i;break;case"e":break t;default:o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(n+1):t},formatPrefixAuto=function(t,e){var n=formatDecimal(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(prefixExponent=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+formatDecimal(t,Math.max(0,e+o-1))[0]},formatRounded=function(t,e){var n=formatDecimal(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},formatTypes={"":formatDefault,"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return formatRounded(100*t,e)},r:formatRounded,s:formatPrefixAuto,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},re=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i,formatSpecifier=function(t){return new FormatSpecifier(t)};FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var locale$1,format,formatPrefix,prefixes=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"],formatLocale=function(t){function e(t){function e(t){var e,i,s,b=d,v=g;if("c"===m)v=p(t)+v,t="";else{t=+t;var w=(t<0||1/t<0)&&(t*=-1,!0);if(t=p(t,f),w)for(e=-1,i=t.length,w=!1;++e<i;)if(s=t.charCodeAt(e),48<s&&s<58||"x"===m&&96<s&&s<103||"X"===m&&64<s&&s<71){w=!0;break}if(b=(w?"("===u?u:"-":"-"===u||"("===u?"":u)+b,v=v+("s"===m?prefixes[8+prefixExponent/3]:"")+(w&&"("===u?")":""),y)for(e=-1,i=t.length;++e<i;)if(s=t.charCodeAt(e),48>s||s>57){v=(46===s?o+t.slice(e+1):t.slice(e))+v,t=t.slice(0,e);break}}h&&!l&&(t=r(t,1/0));var D=b.length+t.length+v.length,M=D<c?new Array(c-D+1).join(n):"";switch(h&&l&&(t=r(M+t,M.length?c-v.length:1/0),M=""),a){case"<":return b+t+v+M;case"=":return b+M+t+v;case"^":return M.slice(0,D=M.length>>1)+b+t+v+M.slice(D)}return M+b+t+v}t=formatSpecifier(t);var n=t.fill,a=t.align,u=t.sign,s=t.symbol,l=t.zero,c=t.width,h=t.comma,f=t.precision,m=t.type,d="$"===s?i[0]:"#"===s&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",g="$"===s?i[1]:/[%p]/.test(m)?"%":"",p=formatTypes[m],y=!m||/[defgprs%]/.test(m);return f=null==f?m?6:12:/[gprs]/.test(m)?Math.max(1,Math.min(21,f)):Math.max(0,Math.min(20,f)),e.toString=function(){return t+""},e}function n(t,n){var r=e((t=formatSpecifier(t),t.type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(exponent(n)/3))),o=Math.pow(10,-i),a=prefixes[8+i/3];return function(t){return r(o*t)+a}}var r=t.grouping&&t.thousands?formatGroup(t.grouping,t.thousands):identity$1,i=t.currency,o=t.decimal;return{format:e,formatPrefix:n}};defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var precisionFixed=function(t){return Math.max(0,-exponent(Math.abs(t)))},precisionPrefix=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(exponent(e)/3)))-exponent(Math.abs(t)))},precisionRound=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,exponent(e)-exponent(t))+1},define=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t},darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$"),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),define(Rgb,rgb,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Rgb(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(1===t?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),define(Hsl,hsl,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Hsl(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Rgb(hsl2rgb(t>=240?t-240:t+120,i,r),hsl2rgb(t,i,r),hsl2rgb(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var deg2rad=Math.PI/180,rad2deg=180/Math.PI,Kn=18,Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;define(Lab,lab,extend(Color,{brighter:function(t){return new Lab(this.l+Kn*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Lab(this.l-Kn*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=Yn*lab2xyz(t),e=Xn*lab2xyz(e),n=Zn*lab2xyz(n),new Rgb(xyz2rgb(3.2404542*e-1.5371385*t-.4985314*n),xyz2rgb(-.969266*e+1.8760108*t+.041556*n),xyz2rgb(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),define(Hcl,hcl,extend(Color,{brighter:function(t){return new Hcl(this.h,this.c,this.l+Kn*(null==t?1:t),this.opacity)},darker:function(t){return new Hcl(this.h,this.c,this.l-Kn*(null==t?1:t),this.opacity)},rgb:function(){return labConvert(this).rgb()}}));var A=-.14861,B=1.78277,C=-.29227,D=-.90649,E=1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;define(Cubehelix,cubehelix,extend(Color,{brighter:function(t){return t=null==t?brighter:Math.pow(brighter,t),new Cubehelix(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?darker:Math.pow(darker,t),new Cubehelix(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*deg2rad,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Rgb(255*(e+n*(A*r+B*i)),255*(e+n*(C*r+D*i)),255*(e+n*(E*r)),this.opacity)}}));var cssNode,cssRoot,cssView,svgNode,constant$1=function(t){return function(){return t}},rgb$1=function t(e){function n(t,e){var n=r((t=rgb(t)).r,(e=rgb(e)).r),i=r(t.g,e.g),o=r(t.b,e.b),a=r(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}var r=gamma(e);return n.gamma=t,n}(1),array$1=function(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(r),a=new Array(r);for(n=0;n<i;++n)o[n]=interpolateValue(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}},date=function(t,e){var n=new Date;return t=+t,e-=t,function(r){return n.setTime(t+e*r),n}},reinterpolate=function(t,e){return t=+t,e-=t,function(n){return t+e*n}},object=function(t,e){var n,r={},i={};null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={});for(n in e)n in t?r[n]=interpolateValue(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}},reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g"),string=function(t,e){var n,r,i,o=reA.lastIndex=reB.lastIndex=0,a=-1,u=[],s=[];for(t+="",e+="";(n=reA.exec(t))&&(r=reB.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(n=n[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,s.push({i:a,x:reinterpolate(n,r)})),o=reB.lastIndex;return o<e.length&&(i=e.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?s[0]?one(s[0].x):zero(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)u[(n=s[r]).i]=n.x(t);return u.join("")})},interpolateValue=function(t,e){var n,r=typeof e;return null==e||"boolean"===r?constant$1(e):("number"===r?reinterpolate:"string"===r?(n=color(e))?(e=n,rgb$1):string:e instanceof color?rgb$1:e instanceof Date?date:Array.isArray(e)?array$1:isNaN(e)?object:reinterpolate)(t,e)},interpolateRound=function(t,e){return t=+t,e-=t,function(n){return Math.round(t+e*n)}},degrees=180/Math.PI,identity$2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},decompose=function(t,e,n,r,i,o){var a,u,s;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,s/=u),t*r<e*n&&(t=-t,e=-e,s=-s,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*degrees,skewX:Math.atan(s)*degrees,scaleX:a,scaleY:u}},rho=Math.SQRT2,rho2=2,rho4=4,epsilon2=1e-12,interpolateHcl=hcl$1(hue);cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma),noop={value:function(){}};Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(t,e){var n,r=this._,i=parseTypenames(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=set$2(r[n],t.name,e);else if(null==e)for(n in r)r[n]=set$2(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=get(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Dispatch(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=this._[t],o=0,n=r.length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var request=function(t,e){function n(t){var e,n=l.status;if(!n&&hasResponse(l)||n>=200&&n<300||304===n){if(o)try{e=o.call(r,l)}catch(t){return void u.call("error",r,t)}else e=l;u.call("load",r,e)}else u.call("error",r,t)}var r,i,o,a,u=dispatch("beforesend","progress","load","error"),s=map$1(),l=new XMLHttpRequest,c=null,h=null,f=0;if("undefined"==typeof XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=l.ontimeout=n:l.onreadystatechange=function(t){l.readyState>3&&n(t)},l.onprogress=function(t){u.call("progress",r,t)},r={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s.get(t):(null==e?s.remove(t):s.set(t,e+""),r)},mimeType:function(t){return arguments.length?(i=null==t?null:t+"",r):i},responseType:function(t){return arguments.length?(a=t,r):a},timeout:function(t){return arguments.length?(f=+t,r):f},user:function(t){return arguments.length<1?c:(c=null==t?null:t+"",r)},password:function(t){return arguments.length<1?h:(h=null==t?null:t+"",r)},response:function(t){return o=t,r},get:function(t,e){return r.send("GET",t,e)},post:function(t,e){return r.send("POST",t,e)},send:function(e,n,o){return l.open(e,t,!0,c,h),null==i||s.has("accept")||s.set("accept",i+",*/*"),l.setRequestHeader&&s.each(function(t,e){l.setRequestHeader(e,t)}),null!=i&&l.overrideMimeType&&l.overrideMimeType(i),null!=a&&(l.responseType=a),f>0&&(l.timeout=f),null==o&&"function"==typeof n&&(o=n,n=null),null!=o&&1===o.length&&(o=fixCallback(o)),null!=o&&r.on("error",o).on("load",function(t){o(null,t)}),u.call("beforesend",r,l),l.send(null==n?null:n),r},abort:function(){return l.abort(),r},on:function(){var t=u.on.apply(u,arguments);return t===u?r:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return r.get(e)}return r},type=function(t,e){return function(n,r){var i=request(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}};type("text/html",function(t){return document.createRange().createContextualFragment(t.responseText)});var json=type("application/json",function(t){return JSON.parse(t.responseText)}),text=type("text/plain",function(t){return t.responseText});type("application/xml",function(t){var e=t.responseXML;if(!e)throw new Error("parse error");return e});var dsv=function(t){function e(t,e){var r,i,o=n(t,function(t,n){return r?r(t,n-1):(i=t,void(r=e?customConverter(t,e):objectConverter(t)))});return o.columns=i,o}function n(t,e){function n(){if(c>=l)return a;if(i)return i=!1,o;var e,n=c;if(34===t.charCodeAt(n)){for(var r=n;r++<l;)if(34===t.charCodeAt(r)){if(34!==t.charCodeAt(r+1))break;++r}return c=r+2,e=t.charCodeAt(r+1),13===e?(i=!0,10===t.charCodeAt(r+2)&&++c):10===e&&(i=!0),t.slice(n+1,r).replace(/""/g,'"')}for(;c<l;){var u=1;if(e=t.charCodeAt(c++),10===e)i=!0;else if(13===e)i=!0,10===t.charCodeAt(c)&&(++c,++u);else if(e!==s)continue;return t.slice(n,c-u)}return t.slice(n)}for(var r,i,o={},a={},u=[],l=t.length,c=0,h=0;(r=n())!==a;){for(var f=[];r!==o&&r!==a;)f.push(r),r=n();e&&null==(f=e(f,h++))||u.push(f)}return u}function r(e,n){return null==n&&(n=inferColumns(e)),[n.map(a).join(t)].concat(e.map(function(e){return n.map(function(t){return a(e[t])}).join(t)})).join("\n")}function i(t){return t.map(o).join("\n")}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":u.test(t+="")?'"'+t.replace(/\"/g,'""')+'"':t}var u=new RegExp('["'+t+"\n]"),s=t.charCodeAt(0);return{parse:e,parseRows:n,format:r,formatRows:i}},csv$1=dsv(","),csvParse=csv$1.parse,tsv=dsv("\t"),tsvParse=tsv.parse,dsv$1=function(t,e){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=request(n).mimeType(t);return o.row=function(t){return arguments.length?o.response(responseOf(e,r=t)):r},o.row(r),i?o.get(i):o}},csv=dsv$1("text/csv",csvParse),tsv$1=dsv$1("text/tab-separated-values",tsvParse),array$2=Array.prototype,map$3=array$2.map,slice$1=array$2.slice,implicit={name:"implicit"},constant$2=function(t){return function(){return t}},number$1=function(t){return+t},unit=[0,1],tickFormat=function(t,e,n){var r,i=t[0],o=t[t.length-1],a=tickStep(i,o,null==e?10:e);switch(n=formatSpecifier(null==n?",f":n),n.type){case"s":var u=Math.max(Math.abs(i),Math.abs(o));return null!=n.precision||isNaN(r=precisionPrefix(a,u))||(n.precision=r),formatPrefix(n,u);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(r=precisionRound(a,Math.max(Math.abs(i),Math.abs(o))))||(n.precision=r-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(r=precisionFixed(a))||(n.precision=r-2*("%"===n.type))}return format(n)},nice=function(t,e){t=t.slice();var n,r=0,i=t.length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t},t0$1=new Date,t1$1=new Date,millisecond=newInterval(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});millisecond.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?newInterval(function(e){e.setTime(Math.floor(e/t)*t)},function(e,n){e.setTime(+e+n*t)},function(e,n){return(n-e)/t}):millisecond:null};var durationSecond$1=1e3,durationMinute$1=6e4,durationHour$1=36e5,durationDay$1=864e5,durationWeek$1=6048e5,second=newInterval(function(t){t.setTime(Math.floor(t/durationSecond$1)*durationSecond$1)},function(t,e){t.setTime(+t+e*durationSecond$1)},function(t,e){return(e-t)/durationSecond$1},function(t){return t.getUTCSeconds()}),minute=newInterval(function(t){t.setTime(Math.floor(t/durationMinute$1)*durationMinute$1)},function(t,e){t.setTime(+t+e*durationMinute$1)},function(t,e){return(e-t)/durationMinute$1},function(t){return t.getMinutes()}),minutes=minute.range,hour=newInterval(function(t){var e=t.getTimezoneOffset()*durationMinute$1%durationHour$1;e<0&&(e+=durationHour$1),t.setTime(Math.floor((+t-e)/durationHour$1)*durationHour$1+e)},function(t,e){t.setTime(+t+e*durationHour$1)},function(t,e){return(e-t)/durationHour$1},function(t){return t.getHours()}),hours=hour.range,day=newInterval(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*durationMinute$1)/durationDay$1},function(t){return t.getDate()-1}),days=day.range,sunday=weekday(0),monday=weekday(1),tuesday=weekday(2),wednesday=weekday(3),thursday=weekday(4),friday=weekday(5),saturday=weekday(6),sundays=sunday.range,mondays=monday.range,month=newInterval(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),months=month.range,year=newInterval(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});year.every=function(t){return isFinite(t=Math.floor(t))&&t>0?newInterval(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n*t)}):null};var years=year.range,utcMinute=newInterval(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*durationMinute$1)},function(t,e){return(e-t)/durationMinute$1},function(t){return t.getUTCMinutes()}),utcHour=newInterval(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+e*durationHour$1)},function(t,e){return(e-t)/durationHour$1},function(t){return t.getUTCHours()}),utcDay=newInterval(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/durationDay$1},function(t){return t.getUTCDate()-1}),utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6),utcMonth=newInterval(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),utcYear=newInterval(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});utcYear.every=function(t){return isFinite(t=Math.floor(t))&&t>0?newInterval(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null};var locale$2,timeFormat,timeParse,utcFormat,utcParse,pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ",formatIso=Date.prototype.toISOString?formatIsoNative:utcFormat(isoSpecifier),parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:utcParse(isoSpecifier),durationSecond=1e3,durationMinute=60*durationSecond,durationHour=60*durationMinute,durationDay=24*durationHour,durationWeek=7*durationDay,durationMonth=30*durationDay,durationYear=365*durationDay,colors=function(t){return t.match(/.{6}/g).map(function(t){return"#"+t})};colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),colors("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),colors("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),colors("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),cubehelixLong(cubehelix(300,.5,0),cubehelix(-240,.5,1));var warm=cubehelixLong(cubehelix(-100,.75,.35),cubehelix(80,1.5,.8)),cool=cubehelixLong(cubehelix(260,.75,.35),cubehelix(80,1.5,.8)),rainbow=cubehelix(),xhtml="http://www.w3.org/1999/xhtml",namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},namespace=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:t}:t},creator=function(t){var e=namespace(t);return(e.local?creatorFixed:creatorInherit)(e)},nextId=0,matcher=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var element=document.documentElement;if(!element.matches){var vendorMatches=element.webkitMatchesSelector||element.msMatchesSelector||element.mozMatchesSelector||element.oMatchesSelector;matcher=function(t){return function(){return vendorMatches.call(this,t)}}}}var matcher$1=matcher,filterEvents={},event=null;if("undefined"!=typeof document){var element$1=document.documentElement;"onmouseenter"in element$1||(filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"})}var selection_on=function(t,e,n){var r,i,o=parseTypenames$1(t+""),a=o.length;if(!(arguments.length<2)){for(u=e?onAdd:onRemove,null==n&&(n=!1),r=0;r<a;++r)this.each(u(o[r],e,n));return this}var u=this.node().__on;if(u)for(var s,l=0,c=u.length;l<c;++l)for(r=0,s=u[l];r<a;++r)if((i=o[r]).type===s.type&&i.name===s.name)return s.value},sourceEvent=function(){for(var t,e=event;t=e.sourceEvent;)e=t;return e},point$1=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]},selector=function(t){return null==t?none:function(){return this.querySelector(t)}},selection_select=function(t){"function"!=typeof t&&(t=selector(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,u=e[i],s=u.length,l=r[i]=new Array(s),c=0;c<s;++c)(o=u[c])&&(a=t.call(o,o.__data__,c,u))&&("__data__"in o&&(a.__data__=o.__data__),l[c]=a);return new Selection(r,this._parents)},selectorAll=function(t){return null==t?empty:function(){return this.querySelectorAll(t)}},selection_selectAll=function(t){"function"!=typeof t&&(t=selectorAll(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,u=e[o],s=u.length,l=0;l<s;++l)(a=u[l])&&(r.push(t.call(a,a.__data__,l,u)),i.push(a));return new Selection(r,i)},selection_filter=function(t){"function"!=typeof t&&(t=matcher$1(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,s=r[i]=[],l=0;l<u;++l)(o=a[l])&&t.call(o,o.__data__,l,a)&&s.push(o);return new Selection(r,this._parents)},sparse=function(t){return new Array(t.length)},selection_enter=function(){return new Selection(this._enter||this._groups.map(sparse),this._parents)};EnterNode.prototype={constructor:EnterNode,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var constant$3=function(t){return function(){return t}},keyPrefix="$",selection_data=function(t,e){if(!t)return m=new Array(this.size()),l=-1,this.each(function(t){m[++l]=t}),m;var n=e?bindKey:bindIndex,r=this._parents,i=this._groups;"function"!=typeof t&&(t=constant$3(t));for(var o=i.length,a=new Array(o),u=new Array(o),s=new Array(o),l=0;l<o;++l){var c=r[l],h=i[l],f=h.length,m=t.call(c,c&&c.__data__,l,r),d=m.length,g=u[l]=new Array(d),p=a[l]=new Array(d),y=s[l]=new Array(f);n(c,h,g,p,y,m,e);for(var b,v,w=0,D=0;w<d;++w)if(b=g[w]){for(w>=D&&(D=w+1);!(v=p[D])&&++D<d;);b._next=v||null}}return a=new Selection(a,r),a._enter=u,a._exit=s,a},selection_exit=function(){return new Selection(this._exit||this._groups.map(sparse),this._parents)},selection_merge=function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var s,l=e[u],c=n[u],h=l.length,f=a[u]=new Array(h),m=0;m<h;++m)(s=l[m]||c[m])&&(f[m]=s);for(;u<r;++u)a[u]=e[u];
return new Selection(a,this._parents)},selection_order=function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},selection_sort=function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=ascending$1);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,u=n[o],s=u.length,l=i[o]=new Array(s),c=0;c<s;++c)(a=u[c])&&(l[c]=a);l.sort(e)}return new Selection(i,this._parents).order()},selection_call=function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},selection_nodes=function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},selection_node=function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},selection_size=function(){var t=0;return this.each(function(){++t}),t},selection_empty=function(){return!this.node()},selection_each=function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},selection_attr=function(t,e){var n=namespace(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?attrRemoveNS:attrRemove:"function"==typeof e?n.local?attrFunctionNS:attrFunction:n.local?attrConstantNS:attrConstant)(n,e))},defaultView=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView},selection_style=function(t,e,n){var r;return arguments.length>1?this.each((null==e?styleRemove:"function"==typeof e?styleFunction:styleConstant)(t,e,null==n?"":n)):defaultView(r=this.node()).getComputedStyle(r,null).getPropertyValue(t)},selection_property=function(t,e){return arguments.length>1?this.each((null==e?propertyRemove:"function"==typeof e?propertyFunction:propertyConstant)(t,e)):this.node()[t]};ClassList.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var selection_classed=function(t,e){var n=classArray(t+"");if(arguments.length<2){for(var r=classList(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?classedFunction:e?classedTrue:classedFalse)(n,e))},selection_text=function(t){return arguments.length?this.each(null==t?textRemove:("function"==typeof t?textFunction:textConstant)(t)):this.node().textContent},selection_html=function(t){return arguments.length?this.each(null==t?htmlRemove:("function"==typeof t?htmlFunction:htmlConstant)(t)):this.node().innerHTML},selection_raise=function(){return this.each(raise$1)},selection_lower=function(){return this.each(lower)},selection_append=function(t){var e="function"==typeof t?t:creator(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},selection_insert=function(t,e){var n="function"==typeof t?t:creator(t),r=null==e?constantNull:"function"==typeof e?e:selector(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},selection_remove=function(){return this.each(remove)},selection_datum=function(t){return arguments.length?this.property("__data__",t):this.node().__data__},selection_dispatch=function(t,e){return this.each(("function"==typeof e?dispatchFunction:dispatchConstant)(t,e))},root=[null];Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,merge:selection_merge,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,datum:selection_datum,on:selection_on,dispatch:selection_dispatch};var select=function(t){return"string"==typeof t?new Selection([[document.querySelector(t)]],[document.documentElement]):new Selection([[t]],root)};class t{constructor(){function t(){o.verticalDomainLabel="top"===o.options.label.position||"bottom"===o.options.label.position,o.domainVerticalLabelHeight=null===o.options.label.height?Math.max(25,2*o.options.cellSize):o.options.label.height,o.domainHorizontalLabelWidth=0,""===o.options.domainLabelFormat&&null===o.options.label.height&&(o.domainVerticalLabelHeight=0),o.verticalDomainLabel||(o.domainVerticalLabelHeight=0,o.domainHorizontalLabelWidth=o.options.label.width),o.paint(),o.options.nextSelector!==!1&&select(o.options.nextSelector).on("click."+o.options.itemNamespace,function(){return event.preventDefault(),o.loadNextDomain(1)}),o.options.previousSelector!==!1&&select(o.options.previousSelector).on("click."+o.options.itemNamespace,function(){return event.preventDefault(),o.loadPreviousDomain(1)}),o.Legend.redraw(o.graphDim.width-o.options.domainGutter-o.options.cellPadding),o.afterLoad();var t=o.getDomainKeys();o.options.loadOnInit?o.getDatas(o.options.data,new Date(t[0]),o.getSubDomain(t[t.length-1]).pop(),function(){o.fill(),o.onComplete()}):o.onComplete(),o.checkIfMinDomainIsReached(t[0]),o.checkIfMaxDomainIsReached(o.getNextDomain().getTime())}function r(t,e){var n=o.options.cellSize*o._domainType[o.options.subDomain].column(t)+o.options.cellPadding*o._domainType[o.options.subDomain].column(t);return 2===arguments.length&&e===!0?n+=o.domainHorizontalLabelWidth+o.options.domainGutter+o.options.domainMargin[1]+o.options.domainMargin[3]:n}function i(t,e){var n=o.options.cellSize*o._domainType[o.options.subDomain].row(t)+o.options.cellPadding*o._domainType[o.options.subDomain].row(t);return 2===arguments.length&&e===!0&&(n+=o.options.domainGutter+o.domainVerticalLabelHeight+o.options.domainMargin[0]+o.options.domainMargin[2]),n}var o=this;this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData(t){return t},onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row(t){return o.getSubDomainRowNumber(t)},column(t){return o.getSubDomainColumnNumber(t)},position:{x(t){return Math.floor(t.getMinutes()/o._domainType.min.row(t))},y(t){return t.getMinutes()%o._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber(t){switch(o.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(o.options.domainDynamicDimension?o.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber(t){switch(o.options.domain){case"day":return 4;case"week":return 28;case"month":return o.options.domainDynamicDimension?o.getDayCountInMonth(t):31}},row(t){return o.getSubDomainRowNumber(t)},column(t){return o.getSubDomainColumnNumber(t)},position:{x(t){return"month"===o.options.domain?o.options.colLimit>0||o.options.rowLimit>0?Math.floor((t.getHours()+24*(t.getDate()-1))/o._domainType.hour.row(t)):Math.floor(t.getHours()/o._domainType.hour.row(t))+4*(t.getDate()-1):"week"===o.options.domain?o.options.colLimit>0||o.options.rowLimit>0?Math.floor((t.getHours()+24*o.getWeekDay(t))/o._domainType.hour.row(t)):Math.floor(t.getHours()/o._domainType.hour.row(t))+4*o.getWeekDay(t):Math.floor(t.getHours()/o._domainType.hour.row(t))},y(t){var e=t.getHours();if(o.options.colLimit>0||o.options.rowLimit>0)switch(o.options.domain){case"month":e+=24*(t.getDate()-1);break;case"week":e+=24*o.getWeekDay(t)}return Math.floor(e%o._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber(t){switch(o.options.domain){case"week":return 7;case"month":return o.options.domainDynamicDimension?o.getDayCountInMonth(t):31;case"year":return o.options.domainDynamicDimension?o.getDayCountInYear(t):366}},defaultColumnNumber(t){switch(t=new Date(t),o.options.domain){case"week":return 1;case"month":return o.options.domainDynamicDimension&&!o.options.verticalOrientation?o.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-o.getWeekNumber(t)+1:6;case"year":return o.options.domainDynamicDimension?o.getWeekNumber(new Date(t.getFullYear(),11,31))-o.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row(t){return o.getSubDomainRowNumber(t)},column(t){return o.getSubDomainColumnNumber(t)},position:{x(t){switch(o.options.domain){case"week":return Math.floor(o.getWeekDay(t)/o._domainType.day.row(t));case"month":return o.options.colLimit>0||o.options.rowLimit>0?Math.floor((t.getDate()-1)/o._domainType.day.row(t)):o.getWeekNumber(t)-o.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":return o.options.colLimit>0||o.options.rowLimit>0?Math.floor((o.getDayOfYear(t)-1)/o._domainType.day.row(t)):o.getWeekNumber(t)}},y(t){var e=o.getWeekDay(t);if(o.options.colLimit>0||o.options.rowLimit>0)switch(o.options.domain){case"year":e=o.getDayOfYear(t)-1;break;case"week":e=o.getWeekDay(t);break;case"month":e=t.getDate()-1}return Math.floor(e%o._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber(t){switch(t=new Date(t),o.options.domain){case"year":return o._domainType.week.maxItemNumber;case"month":return o.options.domainDynamicDimension?o.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-o.getWeekNumber(t):5}},defaultRowNumber:1,row(t){return o.getSubDomainRowNumber(t)},column(t){return o.getSubDomainColumnNumber(t)},position:{x(t){switch(o.options.domain){case"year":return Math.floor(o.getWeekNumber(t)/o._domainType.week.row(t));case"month":return Math.floor(o.getMonthWeekNumber(t)/o._domainType.week.row(t))}},y(t){return o.getWeekNumber(t)%o._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=e.getDay()-(o.options.weekStartOnMonday?1:0);return n<0&&(n=6),e.setDate(e.getDate()-n),e.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row(){return o.getSubDomainRowNumber()},column(){return o.getSubDomainColumnNumber()},position:{x(t){return Math.floor(t.getMonth()/o._domainType.month.row(t))},y(t){return t.getMonth()%o._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth()).getTime()}},year:{name:"year",level:60,row(){return o.options.rowLimit||1},column(){return o.options.colLimit||1},position:{x(){return 1},y(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit(t){return new Date(t.getFullYear()).getTime()}}};for(var a in this._domainType)if(this._domainType.hasOwnProperty(a)){var u=this._domainType[a];this._domainType["x_"+a]={name:"x_"+a,level:u.type,maxItemNumber:u.maxItemNumber,defaultRowNumber:u.defaultRowNumber,defaultColumnNumber:u.defaultColumnNumber,row:u.column,column:u.row,position:{x:u.position.y,y:u.position.x},format:u.format,extractUnit:u.extractUnit}}this.lastInsertedSvg=null,this._completed=!1,this._domains=map$1(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new e,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return o.getDomain(o.options.start).map(function(t){return t.getTime()}).map(function(t){o._domains.set(t,o.getSubDomain(t).map(function(t){return{t:o._domainType[o.options.subDomain].extractUnit(t),v:null}}))}),o.root=select(o.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),o.tooltip=select(o.options.itemSelector).attr("style",function(){var t=select(o.options.itemSelector).attr("style");return(null!==t?t:"")+"position:relative;"}).append("div").attr("class","ch-tooltip"),o.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),o.Legend=new n(o),o.options.paintOnLoad&&t(),!0},this.paint=function(t){function e(e,n,r,i){var a=0;switch(t){case!1:return a=n[r],n[r]+=i,o.domainPosition.setPosition(e,a),a;case o.NAVIGATE_RIGHT:return o.domainPosition.setPosition(e,n[r]),s=i,l=o.domainPosition.getPositionFromIndex(1),o.domainPosition.shiftRightBy(l),n[r];case o.NAVIGATE_LEFT:return a=-i,s=-a,l=n[r]-o.domainPosition.getLast(),o.domainPosition.setPosition(e,a),o.domainPosition.shiftLeftBy(s),a}}function n(t){switch(a.label.rotate){case"right":t.attr("transform",function(t){var e="rotate(90), ";switch(a.label.position){case"right":e+="translate(-"+r(t)+" , -"+r(t)+")";break;case"left":e+="translate(0, -"+o.domainHorizontalLabelWidth+")"}return e});break;case"left":t.attr("transform",function(t){var e="rotate(270), ";switch(a.label.position){case"right":e+="translate(-"+(r(t)+o.domainHorizontalLabelWidth)+" , "+r(t)+")";break;case"left":e+="translate(-"+o.domainHorizontalLabelWidth+" , "+o.domainHorizontalLabelWidth+")"}return e})}}var a=o.options;0===arguments.length&&(t=!1);var u=o.root.select(".graph").selectAll(".graph-domain").data(function(){var e=o.getDomainKeys();return t===o.NAVIGATE_LEFT?e.reverse():e},function(t){return t}),s=0,l=0,c=u.enter().append("svg").attr("width",function(t){return r(t,!0)}).attr("height",function(t){return i(t,!0)}).attr("x",function(t){return a.verticalOrientation?(o.graphDim.width=Math.max(o.graphDim.width,r(t,!0)),0):e(t,o.graphDim,"width",r(t,!0))}).attr("y",function(t){return a.verticalOrientation?e(t,o.graphDim,"height",i(t,!0)):(o.graphDim.height=Math.max(o.graphDim.height,i(t,!0)),0)}).attr("class",function(t){var e="graph-domain",n=new Date(t);switch(a.domain){case"hour":e+=" h_"+n.getHours();case"day":e+=" d_"+n.getDate()+" dy_"+n.getDay();case"week":e+=" w_"+o.getWeekNumber(n);case"month":e+=" m_"+(n.getMonth()+1);case"year":e+=" y_"+n.getFullYear()}return e});o.lastInsertedSvg=c,c.append("rect").attr("width",function(t){return r(t,!0)-a.domainGutter-a.cellPadding}).attr("height",function(t){return i(t,!0)-a.domainGutter-a.cellPadding}).attr("class","domain-background");var h=c.append("svg").attr("x",function(){return"left"===a.label.position?o.domainHorizontalLabelWidth+a.domainMargin[3]:a.domainMargin[3]}).attr("y",function(){return"top"===a.label.position?o.domainVerticalLabelHeight+a.domainMargin[0]:a.domainMargin[0]}).attr("class","graph-subdomain-group"),f=h.selectAll("g").data(function(t){return o._domains.get(t)}).enter().append("g");f.append("rect").attr("class",function(t){return"graph-rect"+o.getHighlightClassName(t.t)+(null!==a.onClick?" hover_cursor":"")}).attr("width",a.cellSize).attr("height",a.cellSize).attr("x",function(t){return o.positionSubDomainX(t.t)}).attr("y",function(t){return o.positionSubDomainY(t.t)}).on("click",function(t){if(null!==a.onClick)return o.onClick(new Date(t.t),t.v)}).call(function(t){a.cellRadius>0&&t.attr("rx",a.cellRadius).attr("ry",a.cellRadius),null!==o.legendScale&&null!==a.legendColors&&a.legendColors.hasOwnProperty("base")&&t.attr("fill",a.legendColors.base),a.tooltip&&(t.on("mouseover",function(t){var e=this.parentNode.parentNode;o.tooltip.html(o.getSubDomainTitle(t)).attr("style","display: block;");var n=o.positionSubDomainX(t.t)-o.tooltip.node().offsetWidth/2+a.cellSize/2,r=o.positionSubDomainY(t.t)-o.tooltip.node().offsetHeight-a.cellSize/2;n+=parseInt(e.getAttribute("x"),10),r+=parseInt(e.getAttribute("y"),10),n+=parseInt(o.root.select(".graph").attr("x"),10),r+=parseInt(o.root.select(".graph").attr("y"),10),n+=parseInt(e.parentNode.getAttribute("x"),10),r+=parseInt(e.parentNode.getAttribute("y"),10),o.tooltip.attr("style","display: block; left: "+n+"px; top: "+r+"px;")}),t.on("mouseout",function(){o.tooltip.attr("style","display:none").html("")}))}),a.tooltip||f.append("title").text(function(t){return o.formatDate(new Date(t.t),a.subDomainDateFormat)}),""!==a.domainLabelFormat&&c.append("text").attr("class","graph-label").attr("y",function(t){var e=a.domainMargin[0];switch(a.label.position){case"top":e+=o.domainVerticalLabelHeight/2;break;case"bottom":e+=i(t)+o.domainVerticalLabelHeight/2}return e+a.label.offset.y*("right"===a.label.rotate&&"right"===a.label.position||"left"===a.label.rotate&&"left"===a.label.position?-1:1)}).attr("x",function(t){var e=a.domainMargin[3];switch(a.label.position){case"right":e+=r(t);break;case"bottom":case"top":e+=r(t)/2}return"right"===a.label.align?e+o.domainHorizontalLabelWidth-a.label.offset.x*("right"===a.label.rotate?-1:1):e+a.label.offset.x}).attr("text-anchor",function(){switch(a.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return o.verticalDomainLabel?"middle":"top"}).text(function(t){return o.formatDate(new Date(t),a.domainLabelFormat)}).call(n),null!==a.subDomainTextFormat&&f.append("text").attr("class",function(t){return"subdomain-text"+o.getHighlightClassName(t.t)}).attr("x",function(t){return o.positionSubDomainX(t.t)+a.cellSize/2}).attr("y",function(t){return o.positionSubDomainY(t.t)+a.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(t){return o.formatDate(new Date(t.t),a.subDomainTextFormat)}),t!==!1&&u.transition().duration(a.animationDuration).attr("x",function(t){return a.verticalOrientation?0:o.domainPosition.getPosition(t)}).attr("y",function(t){return a.verticalOrientation?o.domainPosition.getPosition(t):0});var m=o.graphDim.width,d=o.graphDim.height;a.verticalOrientation?o.graphDim.height+=s-l:o.graphDim.width+=s-l,u.exit().transition().duration(a.animationDuration).attr("x",function(e){if(a.verticalOrientation)return 0;switch(t){case o.NAVIGATE_LEFT:return Math.min(o.graphDim.width,m);case o.NAVIGATE_RIGHT:return-r(e,!0)}}).attr("y",function(e){if(!a.verticalOrientation)return 0;switch(t){case o.NAVIGATE_LEFT:return Math.min(o.graphDim.height,d);case o.NAVIGATE_RIGHT:return-i(e,!0)}}).remove(),o.resize()}}init(t){function e(t,e,n){if((e&&t===!1||t instanceof Element||"string"==typeof t)&&""!==t)return!0;throw new Error("The "+n+" is not valid")}function n(t){switch(t){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min"}}function r(){if(!c._domainType.hasOwnProperty(h.domain)||"min"===h.domain||"x_"===h.domain.substring(0,2))throw new Error("The domain '"+h.domain+"' is not valid");if(!c._domainType.hasOwnProperty(h.subDomain)||"year"===h.subDomain)throw new Error("The subDomain '"+h.subDomain+"' is not valid");if(c._domainType[h.domain].level<=c._domainType[h.subDomain].level)throw new Error("'"+h.subDomain+"' is not a valid subDomain to '"+h.domain+"'");return!0}function i(){if(!t.hasOwnProperty("label")||t.hasOwnProperty("label")&&!t.label.hasOwnProperty("align")){switch(h.label.position){case"left":h.label.align="right";break;case"right":h.label.align="left";break;default:h.label.align="center"}"left"===h.label.rotate?h.label.align="right":"right"===h.label.rotate&&(h.label.align="left")}(!t.hasOwnProperty("label")||t.hasOwnProperty("label")&&!t.label.hasOwnProperty("offset"))&&("left"!==h.label.position&&"right"!==h.label.position||(h.label.offset={x:10,y:15}))}function o(){switch(h.legendVerticalPosition){case"top":h.legendMargin[2]=c.DEFAULT_LEGEND_MARGIN;break;case"bottom":h.legendMargin[0]=c.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":h.legendMargin["right"===h.legendHorizontalPosition?3:1]=c.DEFAULT_LEGEND_MARGIN}}function a(t){switch("number"==typeof t&&(t=[t]),Array.isArray(t)||(console.log("Margin only takes an integer or an array of integers"),t=[0]),t.length){case 1:return[t[0],t[0],t[0],t[0]];case 2:return[t[0],t[1],t[0],t[1]];case 3:return[t[0],t[1],t[2],t[1]];case 4:return t;default:return t.slice(0,4)}}function u(t){return"string"==typeof t?[t,t+(""!==t?"s":"")]:Array.isArray(t)?1===t.length?[t[0],t[0]+"s"]:t.length>2?t.slice(0,2):t:["item","items"]}function s(t){return t>0?t:null}function l(t){return t>0&&h.colLimit>0?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):t>0?t:null}var c=this,h=c.options=mergeRecursive(c.options,t);if(r(),e(h.itemSelector,!1,"itemSelector"),c.allowedDataType.indexOf(h.dataType)===-1)throw new Error("The data type '"+h.dataType+"' is not valid data type");if(null===select(h.itemSelector).node())throw new Error("The node '"+h.itemSelector+"' specified in itemSelector does not exists");try{e(h.nextSelector,!0,"nextSelector"),e(h.previousSelector,!0,"previousSelector")}catch(t){return console.log(t.message),!1}t.hasOwnProperty("subDomain")||(this.options.subDomain=n(t.domain)),"string"==typeof h.itemNamespace&&""!==h.itemNamespace||(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),h.itemNamespace="cal-heatmap");var f=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain"];for(var m in f)t.hasOwnProperty(f[m])&&(h[f[m]]=t[f[m]]);return h.subDomainDateFormat="string"==typeof h.subDomainDateFormat||"function"==typeof h.subDomainDateFormat?h.subDomainDateFormat:this._domainType[h.subDomain].format.date,h.domainLabelFormat="string"==typeof h.domainLabelFormat||"function"==typeof h.domainLabelFormat?h.domainLabelFormat:this._domainType[h.domain].format.legend,h.subDomainTextFormat="string"==typeof h.subDomainTextFormat&&""!==h.subDomainTextFormat||"function"==typeof h.subDomainTextFormat?h.subDomainTextFormat:null,h.domainMargin=a(h.domainMargin),h.legendMargin=a(h.legendMargin),h.highlight=c.expandDateSetting(h.highlight),h.itemName=u(h.itemName),h.colLimit=s(h.colLimit),h.rowLimit=l(h.rowLimit),t.hasOwnProperty("legendMargin")||o(),i(),this._init()}expandDateSetting(t){return Array.isArray(t)||(t=[t]),t.map(function(t){return"now"===t?new Date:t instanceof Date&&t}).filter(function(t){return t!==!1})}fill(t){function e(t){return null!==r.legendScale&&void t.attr("fill",function(t){return null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&!i.considerMissingDataAsZero&&i.legendColors.hasOwnProperty("base")?i.legendColors.base:null!==i.legendColors&&i.legendColors.hasOwnProperty("empty")&&(0===t.v||null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&i.considerMissingDataAsZero)?i.legendColors.empty:t.v<0&&i.legend[0]>0&&null!==i.legendColors&&i.legendColors.hasOwnProperty("overflow")?i.legendColors.overflow:r.legendScale(Math.min(t.v,i.legend[i.legend.length-1]))})}function n(t){"function"==typeof i.subDomainTextFormat&&t.text(function(t){return i.subDomainTextFormat(t.t,t.v)})}var r=this,i=r.options;0===arguments.length&&(t=r.root.selectAll(".graph-domain"));var o=t.selectAll("svg").selectAll("g").data(function(t){return r._domains.get(t)});o.transition().duration(i.animationDuration).select("rect").attr("class",function(t){var e=r.getHighlightClassName(t.t).trim().split(" "),n=r.dateIsLessThan(t.t,new Date),o=r.dateIsEqual(t.t,new Date);return(null===r.legendScale||null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&!i.considerMissingDataAsZero&&!i.legendColors.hasOwnProperty("base"))&&e.push("graph-rect"),o?e.push("now"):n||e.push("future"),null!==t.v?e.push(r.Legend.getClass(t.v,null===r.legendScale)):i.considerMissingDataAsZero&&n&&e.push(r.Legend.getClass(0,null===r.legendScale)),null!==i.onClick&&e.push("hover_cursor"),e.join(" ")}).call(e),o.transition().duration(i.animationDuration).select("title").text(function(t){return r.getSubDomainTitle(t)}),o.transition().duration(i.animationDuration).select("text").attr("class",function(t){return"subdomain-text"+r.getHighlightClassName(t.t)}).call(n)}formatStringWithObject(t,e){for(var n in e)if(e.hasOwnProperty(n)){var r=new RegExp("\\{"+n+"\\}","gi");t=t.replace(r,e[n])}return t}triggerEvent(t,e,n){return!!(3===arguments.length&&n||null===this.options[t])||("function"==typeof this.options[t]?("function"==typeof e&&(e=e()),this.options[t].apply(this,e)):(console.log("Provided callback for "+t+" is not a function."),!1))}onClick(t,e){return this.triggerEvent("onClick",[t,e])}afterLoad(){return this.triggerEvent("afterLoad")}onComplete(){var t=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,t}afterLoadPreviousDomain(t){var e=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]})}afterLoadNextDomain(t){var e=this;return this.triggerEvent("afterLoadNextDomain",function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]})}onMinDomainReached(t){return this._minDomainReached=t,this.triggerEvent("onMinDomainReached",[t])}onMaxDomainReached(t){return this._maxDomainReached=t,this.triggerEvent("onMaxDomainReached",[t])}checkIfMinDomainIsReached(t,e){this.minDomainIsReached(t)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(e)&&this.onMaxDomainReached(!1)}checkIfMaxDomainIsReached(t,e){this.maxDomainIsReached(t)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(e)&&this.onMinDomainReached(!1)}formatNumber(){return format(",g").apply(this,arguments)}formatDate(t,e){if(arguments.length<2&&(e="title"),"function"==typeof e)return e(t);var n=timeFormat(e);return n(t)}getSubDomainTitle(t){if(null!==t.v||this.options.considerMissingDataAsZero){var e=t.v;return null===e&&this.options.considerMissingDataAsZero&&(e=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(e),name:this.options.itemName[1!==e?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})}return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})}loadNextDomain(t){if(this._maxDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),t));return this.afterLoadNextDomain(e.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),e.start),!0}loadPreviousDomain(t){if(this._minDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-t).reverse());return this.afterLoadPreviousDomain(e.start),this.checkIfMinDomainIsReached(e.start,e.end),!0}loadNewDomains(t,e){function n(t){return{t:r._domainType[r.options.subDomain].extractUnit(t),v:null}}for(var r=this,i=t===this.NAVIGATE_LEFT,o=-1,a=e.length,u=this.getDomainKeys();++o<a;){if(i&&this.minDomainIsReached(e[o])){e=e.slice(0,o+1);break}if(!i&&this.maxDomainIsReached(e[o])){e=e.slice(0,o);break}}for(e=e.slice(-this.options.range),o=0,a=e.length;o<a;o++)this._domains.set(e[o].getTime(),this.getSubDomain(e[o]).map(n)),this._domains.remove(i?u.pop():u.shift());return u=this.getDomainKeys(),i&&(e=e.reverse()),this.paint(t),this.getDatas(this.options.data,e[0],this.getSubDomain(e[e.length-1]).pop(),function(){r.fill(r.lastInsertedSvg)}),{start:e[i?0:1],end:u[u.length-1]}}maxDomainIsReached(t){return null!==this.options.maxDate&&this.options.maxDate.getTime()<t}minDomainIsReached(t){return null!==this.options.minDate&&this.options.minDate.getTime()>=t}getDomainKeys(){return this._domains.keys().map(function(t){return parseInt(t,10)}).sort(function(t,e){return t-e})}positionSubDomainX(t){var e=this._domainType[this.options.subDomain].position.x(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding}positionSubDomainY(t){var e=this._domainType[this.options.subDomain].position.y(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding}getSubDomainColumnNumber(t){if(this.options.rowLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.rowLimit)}var n=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof n&&(n=n(t)),this.options.colLimit||n}getSubDomainRowNumber(t){if(this.options.colLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.colLimit)}var n=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof n&&(n=n(t)),this.options.rowLimit||n}getHighlightClassName(t){if(t=new Date(t),this.options.highlight.length>0)for(var e in this.options.highlight)if(this.dateIsEqual(this.options.highlight[e],t))return this.isNow(this.options.highlight[e])?" highlight-now":" highlight";return""}isNow(t){return this.dateIsEqual(t,new Date)}dateIsEqual(t,e){switch(t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),this.options.subDomain){case"x_min":case"min":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours()&&t.getMinutes()===e.getMinutes();case"x_hour":case"hour":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours();case"x_day":case"day":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();case"x_week":case"week":return t.getFullYear()===e.getFullYear()&&this.getWeekNumber(t)===this.getWeekNumber(e);case"x_month":case"month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}}dateIsLessThan(t,e){function n(t,e){switch(e){case"x_min":case"min":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime();case"x_hour":case"hour":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime();case"x_day":case"day":return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(t.getFullYear(),t.getMonth()).getTime();default:return t.getTime()}}return t instanceof Date||(t=new Date(t)),
e instanceof Date||(e=new Date(e)),n(t,this.options.subDomain)<n(e,this.options.subDomain)}getDayOfYear(){return timeFormat("%j").apply(this,arguments)}getWeekNumber(t){var e=timeFormat(this.options.weekStartOnMonday===!0?"%W":"%U");return e(t)}getMonthWeekNumber(t){"number"==typeof t&&(t=new Date(t));var e=this.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return this.getWeekNumber(t)-e-1}getWeekNumberInYear(t){"number"==typeof t&&(t=new Date(t))}getDayCountInMonth(t){return this.getEndOfMonth(t).getDate()}getDayCountInYear(t){return"number"==typeof t&&(t=new Date(t)),1===new Date(t.getFullYear(),1,29).getMonth()?366:365}getWeekDay(t){return this.options.weekStartOnMonday===!1?t.getDay():0===t.getDay()?6:t.getDay()-1}getEndOfMonth(t){return"number"==typeof t&&(t=new Date(t)),new Date(t.getFullYear(),t.getMonth()+1,0)}jumpDate(t,e,n){var r=new Date(t);switch(n){case"hour":r.setHours(r.getHours()+e);break;case"day":r.setHours(r.getHours()+24*e);break;case"week":r.setHours(r.getHours()+24*e*7);break;case"month":r.setMonth(r.getMonth()+e);break;case"year":r.setFullYear(r.getFullYear()+e)}return new Date(r)}getMinuteDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),r=null;return r=e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):new Date(+n+1e3*e*60),minutes(Math.min(n,r),Math.max(n,r))}getHourDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),r=null;e instanceof Date?r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):(r=new Date(n),r.setHours(r.getHours()+e));var i=hours(Math.min(n,r),Math.max(n,r)),o=0,a=i.length;for(o=0;o<a;o++)if(o>0&&i[o].getHours()===i[o-1].getHours()){this.DSTDomain.push(i[o].getTime()),i.splice(o,1);break}return"number"==typeof e&&i.length>Math.abs(e)&&i.splice(i.length-1,1),i}getDayDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=null;return e instanceof Date?r=new Date(e.getFullYear(),e.getMonth(),e.getDate()):(r=new Date(n),r=new Date(r.setDate(r.getDate()+parseInt(e,10)))),days(Math.min(n,r),Math.max(n,r))}getWeekDomain(t,e){var n;this.options.weekStartOnMonday===!1?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()):1===t.getDay()?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()):0===t.getDay()?(n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n.setDate(n.getDate()-6)):n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+1);var r=new Date(n),i=e;return"object"!=typeof e&&(i=new Date(r.setDate(r.getDate()+7*e))),this.options.weekStartOnMonday===!0?mondays(Math.min(n,i),Math.max(n,i)):sundays(Math.min(n,i),Math.max(n,i))}getMonthDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth()),r=null;return e instanceof Date?r=new Date(e.getFullYear(),e.getMonth()):(r=new Date(n),r=r.setMonth(r.getMonth()+e)),months(Math.min(n,r),Math.max(n,r))}getYearDomain(t,e){var n=new Date(t.getFullYear(),0),r=null;return r=e instanceof Date?new Date(e.getFullYear(),0):new Date(t.getFullYear()+e,0),years(Math.min(n,r),Math.max(n,r))}getDomain(t,e){switch("number"==typeof t&&(t=new Date(t)),arguments.length<2&&(e=this.options.range),this.options.domain){case"hour":var n=this.getHourDomain(t,e);return"number"==typeof e&&n.length<e&&(e>0?n.push(this.getHourDomain(n[n.length-1],2)[1]):n.shift(this.getHourDomain(n[0],-2)[0])),n;case"day":return this.getDayDomain(t,e);case"week":return this.getWeekDomain(t,e);case"month":return this.getMonthDomain(t,e);case"year":return this.getYearDomain(t,e)}}getSubDomain(t){"number"==typeof t&&(t=new Date(t));var e=this,n=function(t,n){switch(n){case"year":return e.getDayCountInYear(t);case"month":return e.getDayCountInMonth(t);case"week":return 7}},r=function(t,e){switch(e){case"hour":return 60;case"day":return 1440;case"week":return 10080}},i=function(t,n){switch(n){case"day":return 24;case"week":return 168;case"month":return 24*e.getDayCountInMonth(t)}},o=function(t,n){if("month"===n){var r=new Date(t.getFullYear(),t.getMonth()+1,0),i=e.getWeekNumber(r),o=e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return o>i&&(o=0,i++),i-o+1}if("year"===n)return e.getWeekNumber(new Date(t.getFullYear(),11,31))};switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(t,r(t,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(t,i(t,this.options.domain));case"x_day":case"day":return this.getDayDomain(t,n(t,this.options.domain));case"x_week":case"week":return this.getWeekDomain(t,o(t,this.options.domain));case"x_month":case"month":return this.getMonthDomain(t,12)}}getNextDomain(t){return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),t,this.options.domain),1)[0]}getPreviousDomain(t){return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-t,this.options.domain),1)[0]}getDatas(t,e,n,r,i,o){var a=this;arguments.length<5&&(i=!0),arguments.length<6&&(o=this.APPEND_ON_UPDATE);var u=function(t){i!==!1?"function"==typeof i?t=i(t):"function"==typeof a.options.afterLoadData?t=a.options.afterLoadData(t):console.log("Provided callback for afterLoadData is not a function."):"csv"!==a.options.dataType&&"tsv"!==a.options.dataType||(t=this.interpretCSV(t)),a.parseDatas(t,o,e,n),"function"==typeof r&&r()};switch(typeof t){case"string":if(""===t)return u({}),!0;var s=this.parseURI(t,e,n),l="GET";null!==a.options.dataPostPayload&&(l="POST");var c=null;switch(null!==a.options.dataPostPayload&&(c=this.parseURI(a.options.dataPostPayload,e,n)),this.options.dataType){case"json":json(s,u).send(l,c);break;case"csv":csv(s,u).send(l,c);break;case"tsv":tsv$1(s,u).send(l,c);break;case"txt":text(s,u).send(l,c)}return!1;case"object":if(t===Object(t))return u(t),!1;default:return u({}),!0}}parseDatas(t,e,n,r){e===this.RESET_ALL_ON_UPDATE&&this._domains.forEach(function(t,e){e.forEach(function(t,e,n){n[e].v=null})});var i={},o=function(t){return t.t};for(var a in t){var u=new Date(1e3*a),s=this.getDomain(u)[0].getTime();if(this.DSTDomain.indexOf(s)>=0&&this._domains.has(s-36e5)&&(s-=36e5),!isNaN(a)&&t.hasOwnProperty(a)&&this._domains.has(s)&&s>=+n&&s<+r){var l=this._domains.get(s);i.hasOwnProperty(s)||(i[s]=l.map(o));var c=i[s].indexOf(this._domainType[this.options.subDomain].extractUnit(u));e===this.RESET_SINGLE_ON_UPDATE?l[c].v=t[a]:isNaN(l[c].v)?l[c].v=t[a]:l[c].v+=t[a]}}}parseURI(t,e,n){return t=t.replace(/\{\{t:start\}\}/g,e.getTime()/1e3),t=t.replace(/\{\{t:end\}\}/g,n.getTime()/1e3),t=t.replace(/\{\{d:start\}\}/g,e.toISOString()),t=t.replace(/\{\{d:end\}\}/g,n.toISOString())}interpretCSV(t){var e,n,r={},i=Object.keys(t[0]);for(e=0,n=t.length;e<n;e++)r[t[e][i[0]]]=+t[e][i[1]];return r}resize(){var t=this,e=t.options,n=e.displayLegend?t.Legend.getDim("width")+e.legendMargin[1]+e.legendMargin[3]:0,r=e.displayLegend?t.Legend.getDim("height")+e.legendMargin[0]+e.legendMargin[2]:0,i=t.graphDim.width-e.domainGutter-e.cellPadding,o=t.graphDim.height-e.domainGutter-e.cellPadding;this.root.transition().duration(e.animationDuration).attr("width",function(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?i+n:Math.max(i,n)}).attr("height",function(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?Math.max(o,r):o+r}),this.root.select(".graph").transition().duration(e.animationDuration).attr("y",function(){return"top"===e.legendVerticalPosition?r:0}).attr("x",function(){return"middle"!==e.legendVerticalPosition&&"center"!==e.legendVerticalPosition||"left"!==e.legendHorizontalPosition?0:n})}next(t){return 0===arguments.length&&(t=1),this.loadNextDomain(t)}previous(t){return 0===arguments.length&&(t=1),this.loadPreviousDomain(t)}jumpTo(t,e){arguments.length<2&&(e=!1);var n=this.getDomainKeys(),r=n[0],i=n[n.length-1];return t<r?this.loadPreviousDomain(this.getDomain(r,t).length):e?this.loadNextDomain(this.getDomain(r,t).length):t>i&&this.loadNextDomain(this.getDomain(i,t).length)}rewind(){this.jumpTo(this.options.start,!0)}update(t,e,n){arguments.length<2&&(e=!0),arguments.length<3&&(n=this.RESET_ALL_ON_UPDATE);var r=this.getDomainKeys(),i=this;this.getDatas(t,new Date(r[0]),this.getSubDomain(r[r.length-1]).pop(),function(){i.fill()},e,n)}setLegend(){var t=this.options.legend.slice(0);arguments.length>=1&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),arguments.length>=2&&(Array.isArray(arguments[1])&&arguments[1].length>=2?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(arguments.length>0&&!arrayEquals(t,this.options.legend)||arguments.length>=2)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)}removeLegend(){return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)}showLegend(){return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)}highlight(t){return(this.options.highlight=this.expandDateSetting(t)).length>0&&(this.fill(),!0)}destroy(t){return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each(function(){"function"==typeof t?t():"undefined"!=typeof t&&console.log("Provided callback for destroy() is not a function.")}),null}getSVG(){for(var t={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},e=1,n=this.options.legend.length+1;e<=n;e++)t[".q"+e]={};var r=this.root,i=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],o=function(e,n,r){i.indexOf(n)!==-1&&(t[e][n]=r)},a=function(t){return r.select(t).node()};for(var u in t)if(t.hasOwnProperty(u)){var s=a(u);if(null!==s)if("getComputedStyle"in window){var l=getComputedStyle(s,null);if(0!==l.length)for(var c=0;c<l.length;c++)o(u,l.item(c),l.getPropertyValue(l.item(c)));else for(var h in l)l.hasOwnProperty(h)&&o(u,h,l[h])}else if("currentStyle"in s){var f=s.currentStyle;for(var m in f)o(u,m,f[m])}}var d='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var g in t){d+=g+" {\n";for(var p in t[g])d+="\t"+p+":"+t[g][p]+";\n";d+="}\n"}return d+="]]></style>",d+=(new XMLSerializer).serializeToString(this.root.node()),d+="</svg>"}}class e{constructor(){this.positions=map$1()}getPosition(t){return this.positions.get(t)}getPositionFromIndex(t){var e=this.getKeys();return this.positions.get(e[t])}getLast(){var t=this.getKeys();return this.positions.get(t[t.length-1])}setPosition(t,e){this.positions.set(t,e)}shiftRightBy(t){this.positions.each(function(e,n,r){r.set(e,n-t)});var e=this.getKeys();this.positions.remove(e[0])}shiftLeftBy(t){this.positions.each(function(e,n,r){r.set(e,n+t)});var e=this.getKeys();this.positions.remove(e[e.length-1])}getKeys(){return this.positions.keys().sort(function(t,e){return parseInt(t,10)-parseInt(e,10)})}}class n{constructor(t){this.calendar=t,this.computeDim(),null!==t.options.legendColors&&this.buildColors()}computeDim(){var t=this.calendar.options;this.dim={width:t.legendCellSize*(t.legend.length+1)+t.legendCellPadding*t.legend.length,height:t.legendCellSize}}remove(){this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()}redraw(t){function e(t){t.attr("width",s.legendCellSize).attr("height",s.legendCellSize).attr("x",function(t,e){return e*(s.legendCellSize+s.legendCellPadding)})}function n(){switch(s.legendHorizontalPosition){case"right":return"center"===s.legendVerticalPosition||"middle"===s.legendVerticalPosition?t+s.legendMargin[3]:t-o.getDim("width")-s.legendMargin[1];case"middle":case"center":return Math.round(t/2-o.getDim("width")/2);default:return s.legendMargin[3]}}function r(){return"bottom"===s.legendVerticalPosition?a.graphDim.height+s.legendMargin[0]-s.domainGutter-s.cellPadding:s.legendMargin[0]}if(!this.calendar.options.displayLegend)return!1;var i,o=this,a=this.calendar,u=a.root,s=a.options;this.computeDim();var l=s.legend.slice(0);l.push(l[l.length-1]+1);var c=a.root.select(".graph-legend");null!==c.node()?(u=c,i=u.select("g").selectAll("rect").data(l)):(u="top"===s.legendVerticalPosition?u.insert("svg",".graph"):u.append("svg"),u.attr("x",n()).attr("y",r()),i=u.attr("class","graph-legend").attr("height",o.getDim("height")).attr("width",o.getDim("width")).append("g").selectAll().data(l)),i.enter().append("rect").call(e).attr("class",function(t){return a.Legend.getClass(t,null===a.legendScale)}).attr("fill-opacity",0).call(function(t){null!==a.legendScale&&null!==s.legendColors&&s.legendColors.hasOwnProperty("base")&&t.attr("fill",s.legendColors.base)}).append("title"),i.exit().transition().duration(s.animationDuration).attr("fill-opacity",0).remove(),i.transition().delay(function(t,e){return s.animationDuration*e/10}).call(e).attr("fill-opacity",1).call(function(t){t.attr("fill",function(t,e){return null===a.legendScale?"":0===e?a.legendScale(t-1):a.legendScale(s.legend[e-1])}),t.attr("class",function(t){return a.Legend.getClass(t,null===a.legendScale)})}),i.select("title").text(function(t,e){return 0===e?a.formatStringWithObject(s.legendTitleFormat.lower,{min:s.legend[e],name:s.itemName[1]}):e===l.length-1?a.formatStringWithObject(s.legendTitleFormat.upper,{max:s.legend[e-1],name:s.itemName[1]}):a.formatStringWithObject(s.legendTitleFormat.inner,{down:s.legend[e-1],up:s.legend[e],name:s.itemName[1]})}),u.transition().duration(s.animationDuration).attr("x",n()).attr("y",r()).attr("width",o.getDim("width")).attr("height",o.getDim("height")),u.select("g").transition().duration(s.animationDuration).attr("transform",function(){return"vertical"===s.legendOrientation?"rotate(90 "+s.legendCellSize/2+" "+s.legendCellSize/2+")":""}),a.resize()}getDim(t){var e="horizontal"===this.calendar.options.legendOrientation;switch(t){case"width":return this.dim[e?"width":"height"];case"height":return this.dim[e?"height":"width"]}}buildColors(){var t=this.calendar.options;if(null===t.legendColors)return this.calendar.legendScale=null,!1;var e=[];if(Array.isArray(t.legendColors))e=t.legendColors;else{if(!t.legendColors.hasOwnProperty("min")||!t.legendColors.hasOwnProperty("max"))return t.legendColors=null,!1;e=[t.legendColors.min,t.legendColors.max]}var n=t.legend.slice(0);n[0]>0?n.unshift(0):n[0]<0&&n.unshift(n[0]-(n[n.length-1]-n[0])/n.length);var r=linear$1().range(e).interpolate(interpolateHcl).domain([min(n),max(n)]),i=n.map(function(t){return r(t)});return this.calendar.legendScale=threshold$1().domain(t.legend).range(i),!0}getClass(t,e){if(null===t||isNaN(t))return"";for(var n=[this.calendar.options.legend.length+1],r=0,i=this.calendar.options.legend.length-1;r<=i;r++){if(this.calendar.options.legend[0]>0&&t<0){n=["1","i"];break}if(t<=this.calendar.options.legend[r]){n=[r+1];break}}return 0===t&&n.push(0),n.unshift(""),(n.join(" r")+(e?n.join(" q"):"")).trim()}}export default t;
//# sourceMappingURL=cal-heatmap.es2015.full.min.js.map

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.CalHeatMap=e()}(this,function(){"use strict";function t(t){return function(e,n){return mn(t(e),n)}}function e(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Dn?i*=10:o>=bn?i*=5:o>=Mn&&(i*=2),e<t?-i:i}function n(){}function r(t,e){var r=new n;if(t instanceof n)t.each(function(t,e){r.set(e,t)});else if(Array.isArray(t)){var i,o=-1,a=t.length;if(null==e)for(;++o<a;)r.set(o,t[o]);else for(;++o<a;)r.set(e(i=t[o],o,t),i)}else if(t)for(var u in t)r.set(u,t[u]);return r}function i(){}function o(t,e){var n=new i;if(t instanceof i)t.each(function(t){n.add(t)});else if(t){var r=-1,o=t.length;if(null==e)for(;++r<o;)n.add(t[r]);else for(;++r<o;)n.add(e(t[r],r,t))}return n}function a(t){if(!(e=On.exec(t)))throw new Error("invalid format: "+t);var e,n=e[1]||" ",r=e[2]||">",i=e[3]||"-",o=e[4]||"",a=!!e[5],u=e[6]&&+e[6],s=!!e[7],l=e[8]&&+e[8].slice(1),c=e[9]||"";"n"===c?(s=!0,c="g"):Hn[c]||(c=""),(a||"0"===n&&"="===r)&&(a=!0,n="0",r="="),this.fill=n,this.align=r,this.sign=i,this.symbol=o,this.zero=a,this.width=u,this.comma=s,this.precision=l,this.type=c}function u(t){return t}function s(t){return In=Wn(t),Un=In.format,Rn=In.formatPrefix,In}function l(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function c(){}function h(t){var e;return t=(t+"").trim().toLowerCase(),(e=Jn.exec(t))?(e=parseInt(e[1],16),new p(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1)):(e=Qn.exec(t))?f(parseInt(e[1],16)):(e=tr.exec(t))?new p(e[1],e[2],e[3],1):(e=er.exec(t))?new p(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=nr.exec(t))?g(e[1],e[2],e[3],e[4]):(e=rr.exec(t))?g(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ir.exec(t))?y(e[1],e[2]/100,e[3]/100,1):(e=or.exec(t))?y(e[1],e[2]/100,e[3]/100,e[4]):ar.hasOwnProperty(t)?f(ar[t]):"transparent"===t?new p(NaN,NaN,NaN,0):null}function f(t){return new p(t>>16&255,t>>8&255,255&t,1)}function g(t,e,n,r){return r<=0&&(t=e=n=NaN),new p(t,e,n,r)}function m(t){return t instanceof c||(t=h(t)),t?(t=t.rgb(),new p(t.r,t.g,t.b,t.opacity)):new p}function d(t,e,n,r){return 1===arguments.length?m(t):new p(t,e,n,null==r?1:r)}function p(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function y(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new D(t,e,n,r)}function w(t){if(t instanceof D)return new D(t.h,t.s,t.l,t.opacity);if(t instanceof c||(t=h(t)),!t)return new D;if(t instanceof D)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,u=o-i,s=(o+i)/2;return u?(a=e===o?(n-r)/u+6*(n<r):n===o?(r-e)/u+2:(e-n)/u+4,u/=s<.5?o+i:2-o-i,a*=60):u=s>0&&s<1?0:a,new D(a,u,s,t.opacity)}function v(t,e,n,r){return 1===arguments.length?w(t):new D(t,e,n,null==r?1:r)}function D(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function b(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function M(t){if(t instanceof _)return new _(t.l,t.a,t.b,t.opacity);if(t instanceof L){var e=t.h*ur;return new _(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof p||(t=m(t));var n=S(t.r),r=S(t.g),i=S(t.b),o=T((.4124564*n+.3575761*r+.1804375*i)/cr),a=T((.2126729*n+.7151522*r+.072175*i)/hr),u=T((.0193339*n+.119192*r+.9503041*i)/fr);return new _(116*a-16,500*(o-a),200*(a-u),t.opacity)}function x(t,e,n,r){return 1===arguments.length?M(t):new _(t,e,n,null==r?1:r)}function _(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function T(t){return t>pr?Math.pow(t,1/3):t/dr+gr}function N(t){return t>mr?t*t*t:dr*(t-gr)}function k(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function S(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function C(t){if(t instanceof L)return new L(t.h,t.c,t.l,t.opacity);t instanceof _||(t=M(t));var e=Math.atan2(t.b,t.a)*sr;return new L(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function A(t,e,n,r){return 1===arguments.length?C(t):new L(t,e,n,null==r?1:r)}function L(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function F(t){if(t instanceof E)return new E(t.h,t.s,t.l,t.opacity);t instanceof p||(t=m(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(_r*r+Mr*e-xr*n)/(_r+Mr-xr),o=r-i,a=(br*(n-i)-vr*o)/Dr,u=Math.sqrt(a*a+o*o)/(br*i*(1-i)),s=u?Math.atan2(a,o)*sr-120:NaN;return new E(s<0?s+360:s,u,i,t.opacity)}function P(t,e,n,r){return 1===arguments.length?F(t):new E(t,e,n,null==r?1:r)}function E(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function H(t,e){return function(n){return t+n*e}}function O(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Y(t,e){var n=e-t;return n?H(t,n>180||n<-180?n-360*Math.round(n/360):n):Tr(isNaN(t)?e:t)}function I(t){return 1===(t=+t)?U:function(e,n){return n-e?O(e,n,t):Tr(isNaN(e)?n:e)}}function U(t,e){var n=e-t;return n?H(t,n):Tr(isNaN(t)?e:t)}function R(t){return function(){return t}}function z(t){return function(e){return t(e)+""}}function W(t){return function(e,n){var r=t((e=A(e)).h,(n=A(n)).h),i=U(e.c,n.c),o=U(e.l,n.l),a=U(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}function j(t){return function e(n){function r(e,r){var i=t((e=P(e)).h,(r=P(r)).h),o=U(e.s,r.s),a=U(e.l,r.l),u=U(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=u(t),e+""}}return n=+n,r.gamma=e,r}(1)}function G(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new V(r)}function V(t){this._=t}function q(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}function Z(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function B(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Ir,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}function X(t){return function(e,n){t(null==e?n:null)}}function $(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function K(t){return new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}")}function J(t,e){var n=K(t);return function(r,i){return e(n(r),i,t)}}function Q(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var r in t)r in e||n.push(e[r]=r)}),n}function tt(t,e){return function(n){return t(n.responseText,e)}}function et(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ti(e)}function nt(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=e?0:t>=n?1:r(t)}}}function rt(t){return function(e,n){var r=t(e=+e,n=+n);return function(t){return t<=0?e:t>=1?n:r(t)}}}function it(t,e,n,r){var i=t[0],o=t[1],a=e[0],u=e[1];return o<i?(i=n(o,i),a=r(u,a)):(i=n(i,o),a=r(a,u)),function(t){return a(i(t))}}function ot(t,e,n,r){var i=Math.min(t.length,e.length)-1,o=new Array(i),a=new Array(i),u=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++u<i;)o[u]=n(t[u],t[u+1]),a[u]=r(e[u],e[u+1]);return function(e){var n=yn(t,e,1,i)-1;return a[n](o[n](e))}}function at(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp())}function ut(t,e){function n(){return i=Math.min(u.length,s.length)>2?ot:it,o=a=null,r}function r(e){return(o||(o=i(u,s,c?nt(t):t,l)))(+e)}var i,o,a,u=ni,s=ni,l=Er,c=!1;return r.invert=function(t){return(a||(a=i(s,u,et,c?rt(e):e)))(+t)},r.domain=function(t){return arguments.length?(u=Jr.call(t,ei),n()):u.slice()},r.range=function(t){return arguments.length?(s=Qr.call(t),n()):s.slice()},r.rangeRound=function(t){return s=Qr.call(t),l=Hr,n()},r.clamp=function(t){return arguments.length?(c=!!t,n()):c},r.interpolate=function(t){return arguments.length?(l=t,n()):l},n()}function st(t){var n=t.domain;return t.ticks=function(t){var e=n();return xn(e[0],e[e.length-1],null==t?10:t)},t.tickFormat=function(t,e){return ri(n(),t,e)},t.nice=function(r){var i=n(),o=i.length-1,a=null==r?10:r,u=i[0],s=i[o],l=e(u,s,a);return l&&(l=e(Math.floor(u/l)*l,Math.ceil(s/l)*l,a),i[0]=Math.floor(u/l)*l,i[o]=Math.ceil(s/l)*l,n(i)),t},t}function lt(){var t=ut(et,Cr);return t.copy=function(){return at(t,lt())},st(t)}function ct(){function t(t){if(t<=t)return n[yn(e,t,0,r)]}var e=[.5],n=[0,1],r=1;return t.domain=function(i){return arguments.length?(e=Qr.call(i),r=Math.min(e.length,n.length-1),t):e.slice()},t.range=function(i){return arguments.length?(n=Qr.call(i),r=Math.min(e.length,n.length-1),t):n.slice()},t.invertExtent=function(t){var r=n.indexOf(t);return[e[r-1],e[r]]},t.copy=function(){return ct().domain(e).range(n)},t}function ht(t,e,n,r){function i(e){return t(e=new Date(+e)),e}return i.floor=i,i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return a;do a.push(new Date(+n));while(e(n,o),t(n),n<r);return a},i.filter=function(n){return ht(function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},function(t,r){if(t>=t)for(;--r>=0;)for(;e(t,1),!n(t););})},n&&(i.count=function(e,r){return oi.setTime(+e),ai.setTime(+r),t(oi),t(ai),Math.floor(n(oi,ai))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t===0}:function(e){return i.count(0,e)%t===0}):i:null}),i}function ft(t){return ht(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*li)/fi})}function gt(t){return ht(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/fi})}function mt(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function dt(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function pt(t){return{y:t,m:0,d:1,H:0,M:0,S:0,L:0}}function yt(t){function e(t,e){return function(n){var r,i,o,a=[],u=-1,s=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++u<l;)37===t.charCodeAt(u)&&(a.push(t.slice(s,u)),null!=(i=Oi[r=t.charAt(++u)])?r=t.charAt(++u):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),s=u+1);return a.push(t.slice(s,u)),a.join("")}}function n(t,e){return function(n){var i=pt(1900),o=r(i,t,n+="",0);if(o!=n.length)return null;if("p"in i&&(i.H=i.H%12+12*i.p),"W"in i||"U"in i){"w"in i||(i.w="W"in i?1:0);var a="Z"in i?dt(pt(i.y)).getUTCDay():e(pt(i.y)).getDay();i.m=0,i.d="W"in i?(i.w+6)%7+7*i.W-(a+5)%7:i.w+7*i.U-(a+6)%7}return"Z"in i?(i.H+=i.Z/100|0,i.M+=i.Z%100,dt(i)):e(i)}}function r(t,e,n,r){for(var i,o,a=0,u=e.length,s=n.length;a<u;){if(r>=s)return-1;if(i=e.charCodeAt(a++),37===i){if(i=e.charAt(a++),o=W[i in Oi?e.charAt(a++):i],!o||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function i(t,e,n){var r=A.exec(e.slice(n));return r?(t.p=L[r[0].toLowerCase()],n+r[0].length):-1}function o(t,e,n){var r=E.exec(e.slice(n));return r?(t.w=H[r[0].toLowerCase()],n+r[0].length):-1}function a(t,e,n){var r=F.exec(e.slice(n));return r?(t.w=P[r[0].toLowerCase()],n+r[0].length):-1}function u(t,e,n){var r=I.exec(e.slice(n));return r?(t.m=U[r[0].toLowerCase()],n+r[0].length):-1}function s(t,e,n){var r=O.exec(e.slice(n));return r?(t.m=Y[r[0].toLowerCase()],n+r[0].length):-1}function l(t,e,n){return r(t,M,e,n)}function c(t,e,n){return r(t,x,e,n)}function h(t,e,n){return r(t,_,e,n)}function f(t){return k[t.getDay()]}function g(t){return N[t.getDay()]}function m(t){return C[t.getMonth()]}function d(t){return S[t.getMonth()]}function p(t){return T[+(t.getHours()>=12)]}function y(t){return k[t.getUTCDay()]}function w(t){return N[t.getUTCDay()]}function v(t){return C[t.getUTCMonth()]}function D(t){return S[t.getUTCMonth()]}function b(t){return T[+(t.getUTCHours()>=12)]}var M=t.dateTime,x=t.date,_=t.time,T=t.periods,N=t.days,k=t.shortDays,S=t.months,C=t.shortMonths,A=Dt(T),L=bt(T),F=Dt(N),P=bt(N),E=Dt(k),H=bt(k),O=Dt(S),Y=bt(S),I=Dt(C),U=bt(C),R={a:f,A:g,b:m,B:d,c:null,d:Ot,e:Ot,H:Yt,I:It,j:Ut,L:Rt,m:zt,M:Wt,p:p,S:jt,U:Gt,w:Vt,W:qt,x:null,X:null,y:Zt,Y:Bt,Z:Xt,"%":ce},z={a:y,A:w,b:v,B:D,c:null,d:$t,e:$t,H:Kt,I:Jt,j:Qt,L:te,m:ee,M:ne,p:b,S:re,U:ie,w:oe,W:ae,x:null,X:null,y:ue,Y:se,Z:le,"%":ce},W={a:o,A:a,b:u,B:s,c:l,d:Ct,e:Ct,H:Lt,I:Lt,j:At,L:Et,m:St,M:Ft,p:i,S:Pt,U:xt,w:Mt,W:_t,x:c,X:h,y:Nt,Y:Tt,Z:kt,"%":Ht};return R.x=e(x,R),R.X=e(_,R),R.c=e(M,R),z.x=e(x,z),z.X=e(_,z),z.c=e(M,z),{format:function(t){var n=e(t+="",R);return n.toString=function(){return t},n},parse:function(t){var e=n(t+="",mt);return e.toString=function(){return t},e},utcFormat:function(t){var n=e(t+="",z);return n.toString=function(){return t},n},utcParse:function(t){var e=n(t,dt);return e.toString=function(){return t},e}}}function wt(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function vt(t){return t.replace(Ui,"\\$&")}function Dt(t){return new RegExp("^(?:"+t.map(vt).join("|")+")","i")}function bt(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function Mt(t,e,n){var r=Yi.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function xt(t,e,n){var r=Yi.exec(e.slice(n));return r?(t.U=+r[0],n+r[0].length):-1}function _t(t,e,n){var r=Yi.exec(e.slice(n));return r?(t.W=+r[0],n+r[0].length):-1}function Tt(t,e,n){var r=Yi.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Nt(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function kt(t,e,n){var r=/^(Z)|([+-]\d\d)(?:\:?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function St(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Ct(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function At(t,e,n){var r=Yi.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Lt(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Ft(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Pt(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Et(t,e,n){var r=Yi.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Ht(t,e,n){var r=Ii.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function Ot(t,e){return wt(t.getDate(),e,2)}function Yt(t,e){return wt(t.getHours(),e,2)}function It(t,e){return wt(t.getHours()%12||12,e,2)}function Ut(t,e){return wt(1+yi.count(Ti(t),t),e,3)}function Rt(t,e){return wt(t.getMilliseconds(),e,3)}function zt(t,e){return wt(t.getMonth()+1,e,2)}function Wt(t,e){return wt(t.getMinutes(),e,2)}function jt(t,e){return wt(t.getSeconds(),e,2)}function Gt(t,e){return wt(vi.count(Ti(t),t),e,2)}function Vt(t){return t.getDay()}function qt(t,e){return wt(Di.count(Ti(t),t),e,2)}function Zt(t,e){return wt(t.getFullYear()%100,e,2)}function Bt(t,e){return wt(t.getFullYear()%1e4,e,4)}function Xt(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+wt(e/60|0,"0",2)+wt(e%60,"0",2)}function $t(t,e){return wt(t.getUTCDate(),e,2)}function Kt(t,e){return wt(t.getUTCHours(),e,2)}function Jt(t,e){return wt(t.getUTCHours()%12||12,e,2)}function Qt(t,e){return wt(1+ki.count(Ai(t),t),e,3)}function te(t,e){return wt(t.getUTCMilliseconds(),e,3)}function ee(t,e){return wt(t.getUTCMonth()+1,e,2)}function ne(t,e){return wt(t.getUTCMinutes(),e,2)}function re(t,e){return wt(t.getUTCSeconds(),e,2)}function ie(t,e){return wt(Si.count(Ai(t),t),e,2)}function oe(t){return t.getUTCDay()}function ae(t,e){return wt(Ci.count(Ai(t),t),e,2)}function ue(t,e){return wt(t.getUTCFullYear()%100,e,2)}function se(t,e){return wt(t.getUTCFullYear()%1e4,e,4)}function le(){return"+0000"}function ce(){return"%"}function he(t){return Li=yt(t),Fi=Li.format,Pi=Li.parse,Ei=Li.utcFormat,Hi=Li.utcParse,Li}function fe(t){return t.toISOString()}function ge(t){var e=new Date(t);return isNaN(e)?null:e}function me(t){return new Date(t)}function de(t){return t instanceof Date?+t:+new Date(+t)}function pe(t,n,r,i,o,a,u,s,l){function c(e){return(u(e)<e?d:a(e)<e?p:o(e)<e?y:i(e)<e?w:n(e)<e?r(e)<e?v:D:t(e)<e?b:M)(e)}function h(n,r,i,o){if(null==n&&(n=10),"number"==typeof n){var a=Math.abs(i-r)/n,u=dn(function(t){return t[2]}).right(x,a);u===x.length?(o=e(r/Zi,i/Zi,n),n=t):u?(u=x[a/x[u-1][2]<x[u][2]/a?u-1:u],o=u[1],n=u[0]):(o=e(r,i,n),n=s)}return null==o?n:n.every(o)}var f=ut(et,Cr),g=f.invert,m=f.domain,d=l(".%L"),p=l(":%S"),y=l("%I:%M"),w=l("%I %p"),v=l("%a %d"),D=l("%b %d"),b=l("%B"),M=l("%Y"),x=[[u,1,zi],[u,5,5*zi],[u,15,15*zi],[u,30,30*zi],[a,1,Wi],[a,5,5*Wi],[a,15,15*Wi],[a,30,30*Wi],[o,1,ji],[o,3,3*ji],[o,6,6*ji],[o,12,12*ji],[i,1,Gi],[i,2,2*Gi],[r,1,Vi],[n,1,qi],[n,3,3*qi],[t,1,Zi]];return f.invert=function(t){return new Date(g(t))},f.domain=function(t){return arguments.length?m(Jr.call(t,de)):m().map(me)},f.ticks=function(t,e){var n,r=m(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=h(t,i,o,e),n=n?n.range(i,o+1):[],a?n.reverse():n},f.tickFormat=function(t,e){return null==e?c:l(e)},f.nice=function(t,e){var n=m();return(t=h(t,n[0],n[n.length-1],e))?m(ii(n,t)):f},f.copy=function(){return at(f,pe(t,n,r,i,o,a,u,s,l))},f}function ye(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Xi&&e.documentElement.namespaceURI===Xi?e.createElement(t):e.createElementNS(n,t)}}function we(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ve(t,e,n){return t=De(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function De(t,e,n){return function(r){var i=io;io=r;try{t.call(this,this.__data__,e,n)}finally{io=i}}}function be(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function Me(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function xe(t,e,n){var r=ro.hasOwnProperty(t.type)?ve:De;return function(i,o,a){var u,s=this.__on,l=r(e,o,a);if(s)for(var c=0,h=s.length;c<h;++c)if((u=s[c]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=n),void(u.value=e);this.addEventListener(t.type,l,n),u={type:t.type,name:t.name,value:e,listener:l,capture:n},s?s.push(u):this.__on=[u]}}function _e(){}function Te(){return[]}function Ne(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function ke(t,e,n,r,i,o){for(var a,u=0,s=e.length,l=o.length;u<l;++u)(a=e[u])?(a.__data__=o[u],r[u]=a):n[u]=new Ne(t,o[u]);for(;u<s;++u)(a=e[u])&&(i[u]=a)}function Se(t,e,n,r,i,o,a){var u,s,l,c={},h=e.length,f=o.length,g=new Array(h);for(u=0;u<h;++u)(s=e[u])&&(g[u]=l=po+a.call(s,s.__data__,u,e),l in c?i[u]=s:c[l]=s);for(u=0;u<f;++u)l=po+a.call(t,o[u],u,o),(s=c[l])?(r[u]=s,s.__data__=o[u],c[l]=null):n[u]=new Ne(t,o[u]);for(u=0;u<h;++u)(s=e[u])&&c[g[u]]===s&&(i[u]=s)}function Ce(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Ae(t){return function(){this.removeAttribute(t)}}function Le(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Fe(t,e){return function(){this.setAttribute(t,e)}}function Pe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ee(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function He(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Oe(t){return function(){this.style.removeProperty(t)}}function Ye(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ie(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ue(t){return function(){delete this[t]}}function Re(t,e){return function(){this[t]=e}}function ze(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function We(t){return t.trim().split(/^|\s+/)}function je(t){return t.classList||new Ge(t)}function Ge(t){this._node=t,this._names=We(t.getAttribute("class")||"")}function Ve(t,e){for(var n=je(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function qe(t,e){for(var n=je(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Ze(t){return function(){Ve(this,t)}}function Be(t){return function(){qe(this,t)}}function Xe(t,e){return function(){(e.apply(this,arguments)?Ve:qe)(this,t)}}function $e(){this.textContent=""}function Ke(t){return function(){this.textContent=t}}function Je(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Qe(){this.innerHTML=""}function tn(t){return function(){this.innerHTML=t}}function en(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function nn(){this.nextSibling&&this.parentNode.appendChild(this)}function rn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function on(){return null}function an(){var t=this.parentNode;t&&t.removeChild(this)}function un(t,e,n){var r=Co(t),i=r.CustomEvent;i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function sn(t,e){return function(){return un(this,t,e)}}function ln(t,e){return function(){return un(this,t,e.apply(this,arguments))}}function cn(t,e){this._groups=t,this._parents=e}function hn(){return new cn([[document.documentElement]],Wo)}function fn(t,e){for(var n in e)try{e[n].constructor===Object?t[n]=fn(t[n],e[n]):t[n]=e[n]}catch(r){t[n]=e[n]}return t}function gn(t,e){if(!e||!t)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!gn(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}var mn=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},dn=function(e){return 1===e.length&&(e=t(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}},pn=dn(mn),yn=pn.right,wn=Array.prototype,vn=(wn.slice,wn.map,function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}),Dn=Math.sqrt(50),bn=Math.sqrt(10),Mn=Math.sqrt(2),xn=function(t,n,r){var i=e(t,n,r);return vn(Math.ceil(t/i)*i,Math.floor(n/i)*i+i/2,i)},_n=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&r>n&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&r>n&&(n=r)}return n},Tn=function(t,e){var n,r,i=-1,o=t.length;if(null==e){for(;++i<o;)if(null!=(r=t[i])&&r>=r){n=r;break}for(;++i<o;)null!=(r=t[i])&&n>r&&(n=r)}else{for(;++i<o;)if(null!=(r=e(t[i],i,t))&&r>=r){n=r;break}for(;++i<o;)null!=(r=e(t[i],i,t))&&n>r&&(n=r)}return n},Nn="$";n.prototype=r.prototype={constructor:n,has:function(t){return Nn+t in this},get:function(t){return this[Nn+t]},set:function(t,e){return this[Nn+t]=e,this},remove:function(t){var e=Nn+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Nn&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Nn&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Nn&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Nn&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Nn&&++t;return t},empty:function(){for(var t in this)if(t[0]===Nn)return!1;return!0},each:function(t){for(var e in this)e[0]===Nn&&t(this[e],e.slice(1),this)}};var kn=r.prototype;i.prototype=o.prototype={constructor:i,has:kn.has,add:function(t){return t+="",this[Nn+t]=t,this},remove:kn.remove,clear:kn.clear,values:kn.keys,size:kn.size,empty:kn.empty,each:kn.each};var Sn,Cn=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},An=function(t){return t=Cn(Math.abs(t)),t?t[1]:NaN},Ln=function(t,e){return function(n,r){for(var i=n.length,o=[],a=0,u=t[0],s=0;i>0&&u>0&&(s+u+1>r&&(u=Math.max(1,r-s)),o.push(n.substring(i-=u,i+u)),!((s+=u+1)>r));)u=t[a=(a+1)%t.length];return o.reverse().join(e)}},Fn=function(t,e){t=t.toPrecision(e);t:for(var n,r=t.length,i=1,o=-1;i<r;++i)switch(t[i]){case".":o=n=i;break;case"0":0===o&&(o=i),n=i;break;case"e":break t;default:o>0&&(o=0)}return o>0?t.slice(0,o)+t.slice(n+1):t},Pn=function(t,e){var n=Cn(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Sn=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Cn(t,Math.max(0,e+o-1))[0]},En=function(t,e){var n=Cn(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},Hn={"":Fn,"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return En(100*t,e)},r:En,s:Pn,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},On=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i,Yn=function(t){return new a(t)};a.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var In,Un,Rn,zn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],Wn=function(t){function e(t){function e(t){var e,i,s,w=m,v=d;if("c"===g)v=p(t)+v,t="";else{t=+t;var D=(t<0||1/t<0)&&(t*=-1,!0);if(t=p(t,f),D)for(e=-1,i=t.length,D=!1;++e<i;)if(s=t.charCodeAt(e),48<s&&s<58||"x"===g&&96<s&&s<103||"X"===g&&64<s&&s<71){D=!0;break}if(w=(D?"("===u?u:"-":"-"===u||"("===u?"":u)+w,v=v+("s"===g?zn[8+Sn/3]:"")+(D&&"("===u?")":""),y)for(e=-1,i=t.length;++e<i;)if(s=t.charCodeAt(e),48>s||s>57){v=(46===s?o+t.slice(e+1):t.slice(e))+v,t=t.slice(0,e);break}}h&&!l&&(t=r(t,1/0));var b=w.length+t.length+v.length,M=b<c?new Array(c-b+1).join(n):"";switch(h&&l&&(t=r(M+t,M.length?c-v.length:1/0),M=""),a){case"<":return w+t+v+M;case"=":return w+M+t+v;case"^":return M.slice(0,b=M.length>>1)+w+t+v+M.slice(b)}return M+w+t+v}t=Yn(t);var n=t.fill,a=t.align,u=t.sign,s=t.symbol,l=t.zero,c=t.width,h=t.comma,f=t.precision,g=t.type,m="$"===s?i[0]:"#"===s&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",d="$"===s?i[1]:/[%p]/.test(g)?"%":"",p=Hn[g],y=!g||/[defgprs%]/.test(g);return f=null==f?g?6:12:/[gprs]/.test(g)?Math.max(1,Math.min(21,f)):Math.max(0,Math.min(20,f)),e.toString=function(){return t+""},e}function n(t,n){var r=e((t=Yn(t),t.type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(An(n)/3))),o=Math.pow(10,-i),a=zn[8+i/3];return function(t){return r(o*t)+a}}var r=t.grouping&&t.thousands?Ln(t.grouping,t.thousands):u,i=t.currency,o=t.decimal;return{format:e,formatPrefix:n}};s({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var jn=function(t){return Math.max(0,-An(Math.abs(t)))},Gn=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(An(e)/3)))-An(Math.abs(t)))},Vn=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,An(e)-An(t))+1},qn=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t},Zn=.7,Bn=1/Zn,Xn="\\s*([+-]?\\d+)\\s*",$n="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Kn="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jn=/^#([0-9a-f]{3})$/,Qn=/^#([0-9a-f]{6})$/,tr=new RegExp("^rgb\\("+[Xn,Xn,Xn]+"\\)$"),er=new RegExp("^rgb\\("+[Kn,Kn,Kn]+"\\)$"),nr=new RegExp("^rgba\\("+[Xn,Xn,Xn,$n]+"\\)$"),rr=new RegExp("^rgba\\("+[Kn,Kn,Kn,$n]+"\\)$"),ir=new RegExp("^hsl\\("+[$n,Kn,Kn]+"\\)$"),or=new RegExp("^hsla\\("+[$n,Kn,Kn,$n]+"\\)$"),ar={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qn(c,h,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),qn(p,d,l(c,{brighter:function(t){return t=null==t?Bn:Math.pow(Bn,t),new p(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Zn:Math.pow(Zn,t),new p(this.r*t,this.g*t,this.b*t,this.opacity);
},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(1===t?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),qn(D,v,l(c,{brighter:function(t){return t=null==t?Bn:Math.pow(Bn,t),new D(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Zn:Math.pow(Zn,t),new D(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new p(b(t>=240?t-240:t+120,i,r),b(t,i,r),b(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var ur=Math.PI/180,sr=180/Math.PI,lr=18,cr=.95047,hr=1,fr=1.08883,gr=4/29,mr=6/29,dr=3*mr*mr,pr=mr*mr*mr;qn(_,x,l(c,{brighter:function(t){return new _(this.l+lr*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new _(this.l-lr*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return t=hr*N(t),e=cr*N(e),n=fr*N(n),new p(k(3.2404542*e-1.5371385*t-.4985314*n),k(-.969266*e+1.8760108*t+.041556*n),k(.0556434*e-.2040259*t+1.0572252*n),this.opacity)}})),qn(L,A,l(c,{brighter:function(t){return new L(this.h,this.c,this.l+lr*(null==t?1:t),this.opacity)},darker:function(t){return new L(this.h,this.c,this.l-lr*(null==t?1:t),this.opacity)},rgb:function(){return M(this).rgb()}}));var yr=-.14861,wr=1.78277,vr=-.29227,Dr=-.90649,br=1.97294,Mr=br*Dr,xr=br*wr,_r=wr*vr-Dr*yr;qn(E,P,l(c,{brighter:function(t){return t=null==t?Bn:Math.pow(Bn,t),new E(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Zn:Math.pow(Zn,t),new E(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*ur,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new p(255*(e+n*(yr*r+wr*i)),255*(e+n*(vr*r+Dr*i)),255*(e+n*(br*r)),this.opacity)}}));var Tr=function(t){return function(){return t}},Nr=function t(e){function n(t,e){var n=r((t=d(t)).r,(e=d(e)).r),i=r(t.g,e.g),o=r(t.b,e.b),a=r(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}var r=I(e);return n.gamma=t,n}(1),kr=function(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(r),a=new Array(r);for(n=0;n<i;++n)o[n]=Er(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}},Sr=function(t,e){var n=new Date;return t=+t,e-=t,function(r){return n.setTime(t+e*r),n}},Cr=function(t,e){return t=+t,e-=t,function(n){return t+e*n}},Ar=function(t,e){var n,r={},i={};null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={});for(n in e)n in t?r[n]=Er(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}},Lr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fr=new RegExp(Lr.source,"g"),Pr=function(t,e){var n,r,i,o=Lr.lastIndex=Fr.lastIndex=0,a=-1,u=[],s=[];for(t+="",e+="";(n=Lr.exec(t))&&(r=Fr.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(n=n[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,s.push({i:a,x:Cr(n,r)})),o=Fr.lastIndex;return o<e.length&&(i=e.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?s[0]?z(s[0].x):R(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)u[(n=s[r]).i]=n.x(t);return u.join("")})},Er=function(t,e){var n,r=typeof e;return null==e||"boolean"===r?Tr(e):("number"===r?Cr:"string"===r?(n=h(e))?(e=n,Nr):Pr:e instanceof h?Nr:e instanceof Date?Sr:Array.isArray(e)?kr:isNaN(e)?Ar:Cr)(t,e)},Hr=function(t,e){return t=+t,e-=t,function(n){return Math.round(t+e*n)}},Or=(180/Math.PI,Math.SQRT2,W(Y));j(Y);var Yr=j(U),Ir={value:function(){}};V.prototype=G.prototype={constructor:V,on:function(t,e){var n,r=this._,i=q(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=B(r[n],t.name,e);else if(null==e)for(n in r)r[n]=B(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=Z(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new V(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=this._[t],o=0,n=r.length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var Ur=function(t,e){function n(t){var e,n=c.status;if(!n&&$(c)||n>=200&&n<300||304===n){if(a)try{e=a.call(i,c)}catch(t){return void s.call("error",i,t)}else e=c;s.call("load",i,e)}else s.call("error",i,t)}var i,o,a,u,s=G("beforesend","progress","load","error"),l=r(),c=new XMLHttpRequest,h=null,f=null,g=0;if("undefined"==typeof XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(t)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=c.ontimeout=n:c.onreadystatechange=function(t){c.readyState>3&&n(t)},c.onprogress=function(t){s.call("progress",i,t)},i={header:function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?l.get(t):(null==e?l.remove(t):l.set(t,e+""),i)},mimeType:function(t){return arguments.length?(o=null==t?null:t+"",i):o},responseType:function(t){return arguments.length?(u=t,i):u},timeout:function(t){return arguments.length?(g=+t,i):g},user:function(t){return arguments.length<1?h:(h=null==t?null:t+"",i)},password:function(t){return arguments.length<1?f:(f=null==t?null:t+"",i)},response:function(t){return a=t,i},get:function(t,e){return i.send("GET",t,e)},post:function(t,e){return i.send("POST",t,e)},send:function(e,n,r){return c.open(e,t,!0,h,f),null==o||l.has("accept")||l.set("accept",o+",*/*"),c.setRequestHeader&&l.each(function(t,e){c.setRequestHeader(e,t)}),null!=o&&c.overrideMimeType&&c.overrideMimeType(o),null!=u&&(c.responseType=u),g>0&&(c.timeout=g),null==r&&"function"==typeof n&&(r=n,n=null),null!=r&&1===r.length&&(r=X(r)),null!=r&&i.on("error",r).on("load",function(t){r(null,t)}),s.call("beforesend",i,c),c.send(null==n?null:n),i},abort:function(){return c.abort(),i},on:function(){var t=s.on.apply(s,arguments);return t===s?i:t}},null!=e){if("function"!=typeof e)throw new Error("invalid callback: "+e);return i.get(e)}return i},Rr=function(t,e){return function(n,r){var i=Ur(n).mimeType(t).response(e);if(null!=r){if("function"!=typeof r)throw new Error("invalid callback: "+r);return i.get(r)}return i}};Rr("text/html",function(t){return document.createRange().createContextualFragment(t.responseText)});var zr=Rr("application/json",function(t){return JSON.parse(t.responseText)}),Wr=Rr("text/plain",function(t){return t.responseText});Rr("application/xml",function(t){var e=t.responseXML;if(!e)throw new Error("parse error");return e});var jr=function(t){function e(t,e){var r,i,o=n(t,function(t,n){return r?r(t,n-1):(i=t,void(r=e?J(t,e):K(t)))});return o.columns=i,o}function n(t,e){function n(){if(c>=l)return a;if(i)return i=!1,o;var e,n=c;if(34===t.charCodeAt(n)){for(var r=n;r++<l;)if(34===t.charCodeAt(r)){if(34!==t.charCodeAt(r+1))break;++r}return c=r+2,e=t.charCodeAt(r+1),13===e?(i=!0,10===t.charCodeAt(r+2)&&++c):10===e&&(i=!0),t.slice(n+1,r).replace(/""/g,'"')}for(;c<l;){var u=1;if(e=t.charCodeAt(c++),10===e)i=!0;else if(13===e)i=!0,10===t.charCodeAt(c)&&(++c,++u);else if(e!==s)continue;return t.slice(n,c-u)}return t.slice(n)}for(var r,i,o={},a={},u=[],l=t.length,c=0,h=0;(r=n())!==a;){for(var f=[];r!==o&&r!==a;)f.push(r),r=n();e&&null==(f=e(f,h++))||u.push(f)}return u}function r(e,n){return null==n&&(n=Q(e)),[n.map(a).join(t)].concat(e.map(function(e){return n.map(function(t){return a(e[t])}).join(t)})).join("\n")}function i(t){return t.map(o).join("\n")}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":u.test(t+="")?'"'+t.replace(/\"/g,'""')+'"':t}var u=new RegExp('["'+t+"\n]"),s=t.charCodeAt(0);return{parse:e,parseRows:n,format:r,formatRows:i}},Gr=jr(","),Vr=Gr.parse,qr=jr("\t"),Zr=qr.parse,Br=function(t,e){return function(n,r,i){arguments.length<3&&(i=r,r=null);var o=Ur(n).mimeType(t);return o.row=function(t){return arguments.length?o.response(tt(e,r=t)):r},o.row(r),i?o.get(i):o}},Xr=Br("text/csv",Vr),$r=Br("text/tab-separated-values",Zr),Kr=Array.prototype,Jr=Kr.map,Qr=Kr.slice,ti=function(t){return function(){return t}},ei=function(t){return+t},ni=[0,1],ri=function(t,n,r){var i,o=t[0],a=t[t.length-1],u=e(o,a,null==n?10:n);switch(r=Yn(null==r?",f":r),r.type){case"s":var s=Math.max(Math.abs(o),Math.abs(a));return null!=r.precision||isNaN(i=Gn(u,s))||(r.precision=i),Rn(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Vn(u,Math.max(Math.abs(o),Math.abs(a))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=jn(u))||(r.precision=i-2*("%"===r.type))}return Un(r)},ii=function(t,e){t=t.slice();var n,r=0,i=t.length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t},oi=new Date,ai=new Date,ui=ht(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});ui.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?ht(function(e){e.setTime(Math.floor(e/t)*t)},function(e,n){e.setTime(+e+n*t)},function(e,n){return(n-e)/t}):ui:null};var si=1e3,li=6e4,ci=36e5,hi=864e5,fi=6048e5,gi=(ht(function(t){t.setTime(Math.floor(t/si)*si)},function(t,e){t.setTime(+t+e*si)},function(t,e){return(e-t)/si},function(t){return t.getUTCSeconds()}),ht(function(t){t.setTime(Math.floor(t/li)*li)},function(t,e){t.setTime(+t+e*li)},function(t,e){return(e-t)/li},function(t){return t.getMinutes()})),mi=gi.range,di=ht(function(t){var e=t.getTimezoneOffset()*li%ci;e<0&&(e+=ci),t.setTime(Math.floor((+t-e)/ci)*ci+e)},function(t,e){t.setTime(+t+e*ci)},function(t,e){return(e-t)/ci},function(t){return t.getHours()}),pi=di.range,yi=ht(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*li)/hi},function(t){return t.getDate()-1}),wi=yi.range,vi=ft(0),Di=ft(1),bi=(ft(2),ft(3),ft(4),ft(5),ft(6),vi.range),Mi=Di.range,xi=ht(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),_i=xi.range,Ti=ht(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});Ti.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ht(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n*t)}):null};var Ni=Ti.range,ki=(ht(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*li)},function(t,e){return(e-t)/li},function(t){return t.getUTCMinutes()}),ht(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+e*ci)},function(t,e){return(e-t)/ci},function(t){return t.getUTCHours()}),ht(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/hi},function(t){return t.getUTCDate()-1})),Si=gt(0),Ci=gt(1),Ai=(gt(2),gt(3),gt(4),gt(5),gt(6),ht(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),ht(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()}));Ai.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ht(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null};var Li,Fi,Pi,Ei,Hi,Oi={"-":"",_:" ",0:"0"},Yi=/^\s*\d+/,Ii=/^%/,Ui=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;he({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Ri="%Y-%m-%dT%H:%M:%S.%LZ",zi=(Date.prototype.toISOString?fe:Ei(Ri),+new Date("2000-01-01T00:00:00.000Z")?ge:Hi(Ri),1e3),Wi=60*zi,ji=60*Wi,Gi=24*ji,Vi=7*Gi,qi=30*Gi,Zi=365*Gi,Bi=function(t){return t.match(/.{6}/g).map(function(t){return"#"+t})};Bi("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Bi("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),Bi("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),Bi("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),Yr(P(300,.5,0),P(-240,.5,1));var Xi=(Yr(P(-100,.75,.35),P(80,1.5,.8)),Yr(P(260,.75,.35),P(80,1.5,.8)),P(),"http://www.w3.org/1999/xhtml"),$i={svg:"http://www.w3.org/2000/svg",xhtml:Xi,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Ki=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),$i.hasOwnProperty(e)?{space:$i[e],local:t}:t},Ji=function(t){var e=Ki(t);return(e.local?we:ye)(e)},Qi=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var to=document.documentElement;if(!to.matches){var eo=to.webkitMatchesSelector||to.msMatchesSelector||to.mozMatchesSelector||to.oMatchesSelector;Qi=function(t){return function(){return eo.call(this,t)}}}}var no=Qi,ro={},io=null;if("undefined"!=typeof document){var oo=document.documentElement;"onmouseenter"in oo||(ro={mouseenter:"mouseover",mouseleave:"mouseout"})}var ao=function(t,e,n){var r,i,o=be(t+""),a=o.length;if(!(arguments.length<2)){for(u=e?xe:Me,null==n&&(n=!1),r=0;r<a;++r)this.each(u(o[r],e,n));return this}var u=this.node().__on;if(u)for(var s,l=0,c=u.length;l<c;++l)for(r=0,s=u[l];r<a;++r)if((i=o[r]).type===s.type&&i.name===s.name)return s.value},uo=function(t){return null==t?_e:function(){return this.querySelector(t)}},so=function(t){"function"!=typeof t&&(t=uo(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,u=e[i],s=u.length,l=r[i]=new Array(s),c=0;c<s;++c)(o=u[c])&&(a=t.call(o,o.__data__,c,u))&&("__data__"in o&&(a.__data__=o.__data__),l[c]=a);return new cn(r,this._parents)},lo=function(t){return null==t?Te:function(){return this.querySelectorAll(t)}},co=function(t){"function"!=typeof t&&(t=lo(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,u=e[o],s=u.length,l=0;l<s;++l)(a=u[l])&&(r.push(t.call(a,a.__data__,l,u)),i.push(a));return new cn(r,i)},ho=function(t){"function"!=typeof t&&(t=no(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,s=r[i]=[],l=0;l<u;++l)(o=a[l])&&t.call(o,o.__data__,l,a)&&s.push(o);return new cn(r,this._parents)},fo=function(t){return new Array(t.length)},go=function(){return new cn(this._enter||this._groups.map(fo),this._parents)};Ne.prototype={constructor:Ne,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var mo=function(t){return function(){return t}},po="$",yo=function(t,e){if(!t)return g=new Array(this.size()),l=-1,this.each(function(t){g[++l]=t}),g;var n=e?Se:ke,r=this._parents,i=this._groups;"function"!=typeof t&&(t=mo(t));for(var o=i.length,a=new Array(o),u=new Array(o),s=new Array(o),l=0;l<o;++l){var c=r[l],h=i[l],f=h.length,g=t.call(c,c&&c.__data__,l,r),m=g.length,d=u[l]=new Array(m),p=a[l]=new Array(m),y=s[l]=new Array(f);n(c,h,d,p,y,g,e);for(var w,v,D=0,b=0;D<m;++D)if(w=d[D]){for(D>=b&&(b=D+1);!(v=p[b])&&++b<m;);w._next=v||null}}return a=new cn(a,r),a._enter=u,a._exit=s,a},wo=function(){return new cn(this._exit||this._groups.map(fo),this._parents)},vo=function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var s,l=e[u],c=n[u],h=l.length,f=a[u]=new Array(h),g=0;g<h;++g)(s=l[g]||c[g])&&(f[g]=s);for(;u<r;++u)a[u]=e[u];return new cn(a,this._parents)},Do=function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},bo=function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Ce);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,u=n[o],s=u.length,l=i[o]=new Array(s),c=0;c<s;++c)(a=u[c])&&(l[c]=a);l.sort(e)}return new cn(i,this._parents).order()},Mo=function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},xo=function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},_o=function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},To=function(){var t=0;return this.each(function(){++t}),t},No=function(){return!this.node()},ko=function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},So=function(t,e){var n=Ki(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?Le:Ae:"function"==typeof e?n.local?He:Ee:n.local?Pe:Fe)(n,e))},Co=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView},Ao=function(t,e,n){var r;return arguments.length>1?this.each((null==e?Oe:"function"==typeof e?Ie:Ye)(t,e,null==n?"":n)):Co(r=this.node()).getComputedStyle(r,null).getPropertyValue(t)},Lo=function(t,e){return arguments.length>1?this.each((null==e?Ue:"function"==typeof e?ze:Re)(t,e)):this.node()[t]};Ge.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Fo=function(t,e){var n=We(t+"");if(arguments.length<2){for(var r=je(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?Xe:e?Ze:Be)(n,e))},Po=function(t){return arguments.length?this.each(null==t?$e:("function"==typeof t?Je:Ke)(t)):this.node().textContent},Eo=function(t){return arguments.length?this.each(null==t?Qe:("function"==typeof t?en:tn)(t)):this.node().innerHTML},Ho=function(){return this.each(nn)},Oo=function(){return this.each(rn)},Yo=function(t){var e="function"==typeof t?t:Ji(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},Io=function(t,e){var n="function"==typeof t?t:Ji(t),r=null==e?on:"function"==typeof e?e:uo(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},Uo=function(){return this.each(an)},Ro=function(t){return arguments.length?this.property("__data__",t):this.node().__data__},zo=function(t,e){return this.each(("function"==typeof e?ln:sn)(t,e))},Wo=[null];cn.prototype=hn.prototype={constructor:cn,select:so,selectAll:co,filter:ho,data:yo,enter:go,exit:wo,merge:vo,order:Do,sort:bo,call:Mo,nodes:xo,node:_o,size:To,empty:No,each:ko,attr:So,style:Ao,property:Lo,classed:Fo,text:Po,html:Eo,raise:Ho,lower:Oo,append:Yo,insert:Io,remove:Uo,datum:Ro,on:ao,dispatch:zo};var jo=function(t){return"string"==typeof t?new cn([[document.querySelector(t)]],[document.documentElement]):new cn([[t]],Wo)};class Go{constructor(){function t(){i.verticalDomainLabel="top"===i.options.label.position||"bottom"===i.options.label.position,i.domainVerticalLabelHeight=null===i.options.label.height?Math.max(25,2*i.options.cellSize):i.options.label.height,i.domainHorizontalLabelWidth=0,""===i.options.domainLabelFormat&&null===i.options.label.height&&(i.domainVerticalLabelHeight=0),i.verticalDomainLabel||(i.domainVerticalLabelHeight=0,i.domainHorizontalLabelWidth=i.options.label.width),i.paint(),i.options.nextSelector!==!1&&jo(i.options.nextSelector).on("click."+i.options.itemNamespace,function(){return io.preventDefault(),i.loadNextDomain(1)}),i.options.previousSelector!==!1&&jo(i.options.previousSelector).on("click."+i.options.itemNamespace,function(){return io.preventDefault(),i.loadPreviousDomain(1)}),i.Legend.redraw(i.graphDim.width-i.options.domainGutter-i.options.cellPadding),i.afterLoad();var t=i.getDomainKeys();i.options.loadOnInit?i.getDatas(i.options.data,new Date(t[0]),i.getSubDomain(t[t.length-1]).pop(),function(){i.fill(),i.onComplete()}):i.onComplete(),i.checkIfMinDomainIsReached(t[0]),i.checkIfMaxDomainIsReached(i.getNextDomain().getTime())}function e(t,e){var n=i.options.cellSize*i._domainType[i.options.subDomain].column(t)+i.options.cellPadding*i._domainType[i.options.subDomain].column(t);return 2===arguments.length&&e===!0?n+=i.domainHorizontalLabelWidth+i.options.domainGutter+i.options.domainMargin[1]+i.options.domainMargin[3]:n}function n(t,e){var n=i.options.cellSize*i._domainType[i.options.subDomain].row(t)+i.options.cellPadding*i._domainType[i.options.subDomain].row(t);return 2===arguments.length&&e===!0&&(n+=i.options.domainGutter+i.domainVerticalLabelHeight+i.options.domainMargin[0]+i.options.domainMargin[2]),n}var i=this;this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData(t){return t},onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row(t){return i.getSubDomainRowNumber(t)},column(t){return i.getSubDomainColumnNumber(t)},position:{x(t){return Math.floor(t.getMinutes()/i._domainType.min.row(t))},y(t){return t.getMinutes()%i._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber(t){switch(i.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(i.options.domainDynamicDimension?i.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber(t){switch(i.options.domain){case"day":return 4;case"week":return 28;case"month":return i.options.domainDynamicDimension?i.getDayCountInMonth(t):31}},row(t){return i.getSubDomainRowNumber(t)},column(t){return i.getSubDomainColumnNumber(t)},position:{x(t){return"month"===i.options.domain?i.options.colLimit>0||i.options.rowLimit>0?Math.floor((t.getHours()+24*(t.getDate()-1))/i._domainType.hour.row(t)):Math.floor(t.getHours()/i._domainType.hour.row(t))+4*(t.getDate()-1):"week"===i.options.domain?i.options.colLimit>0||i.options.rowLimit>0?Math.floor((t.getHours()+24*i.getWeekDay(t))/i._domainType.hour.row(t)):Math.floor(t.getHours()/i._domainType.hour.row(t))+4*i.getWeekDay(t):Math.floor(t.getHours()/i._domainType.hour.row(t))},y(t){var e=t.getHours();if(i.options.colLimit>0||i.options.rowLimit>0)switch(i.options.domain){case"month":e+=24*(t.getDate()-1);break;case"week":e+=24*i.getWeekDay(t)}return Math.floor(e%i._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber(t){switch(i.options.domain){case"week":return 7;case"month":return i.options.domainDynamicDimension?i.getDayCountInMonth(t):31;case"year":return i.options.domainDynamicDimension?i.getDayCountInYear(t):366}},defaultColumnNumber(t){switch(t=new Date(t),i.options.domain){case"week":return 1;case"month":return i.options.domainDynamicDimension&&!i.options.verticalOrientation?i.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-i.getWeekNumber(t)+1:6;case"year":return i.options.domainDynamicDimension?i.getWeekNumber(new Date(t.getFullYear(),11,31))-i.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row(t){return i.getSubDomainRowNumber(t)},column(t){return i.getSubDomainColumnNumber(t)},position:{x(t){switch(i.options.domain){case"week":return Math.floor(i.getWeekDay(t)/i._domainType.day.row(t));case"month":return i.options.colLimit>0||i.options.rowLimit>0?Math.floor((t.getDate()-1)/i._domainType.day.row(t)):i.getWeekNumber(t)-i.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":return i.options.colLimit>0||i.options.rowLimit>0?Math.floor((i.getDayOfYear(t)-1)/i._domainType.day.row(t)):i.getWeekNumber(t)}},y(t){var e=i.getWeekDay(t);if(i.options.colLimit>0||i.options.rowLimit>0)switch(i.options.domain){case"year":e=i.getDayOfYear(t)-1;break;case"week":e=i.getWeekDay(t);break;case"month":e=t.getDate()-1}return Math.floor(e%i._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber(t){switch(t=new Date(t),i.options.domain){case"year":return i._domainType.week.maxItemNumber;case"month":return i.options.domainDynamicDimension?i.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-i.getWeekNumber(t):5}},defaultRowNumber:1,row(t){return i.getSubDomainRowNumber(t)},column(t){return i.getSubDomainColumnNumber(t)},position:{x(t){switch(i.options.domain){case"year":return Math.floor(i.getWeekNumber(t)/i._domainType.week.row(t));case"month":return Math.floor(i.getMonthWeekNumber(t)/i._domainType.week.row(t))}},y(t){return i.getWeekNumber(t)%i._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=e.getDay()-(i.options.weekStartOnMonday?1:0);return n<0&&(n=6),e.setDate(e.getDate()-n),e.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row(){return i.getSubDomainRowNumber()},column(){return i.getSubDomainColumnNumber()},position:{x(t){return Math.floor(t.getMonth()/i._domainType.month.row(t))},y(t){return t.getMonth()%i._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit(t){return new Date(t.getFullYear(),t.getMonth()).getTime()}},year:{name:"year",level:60,row(){return i.options.rowLimit||1},column(){return i.options.colLimit||1},position:{x(){return 1},y(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit(t){return new Date(t.getFullYear()).getTime()}}};for(var o in this._domainType)if(this._domainType.hasOwnProperty(o)){var a=this._domainType[o];this._domainType["x_"+o]={name:"x_"+o,level:a.type,maxItemNumber:a.maxItemNumber,defaultRowNumber:a.defaultRowNumber,defaultColumnNumber:a.defaultColumnNumber,row:a.column,column:a.row,position:{x:a.position.y,y:a.position.x},format:a.format,extractUnit:a.extractUnit}}this.lastInsertedSvg=null,this._completed=!1,this._domains=r(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new Vo,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return i.getDomain(i.options.start).map(function(t){return t.getTime()}).map(function(t){i._domains.set(t,i.getSubDomain(t).map(function(t){return{t:i._domainType[i.options.subDomain].extractUnit(t),v:null}}))}),i.root=jo(i.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),i.tooltip=jo(i.options.itemSelector).attr("style",function(){var t=jo(i.options.itemSelector).attr("style");return(null!==t?t:"")+"position:relative;"}).append("div").attr("class","ch-tooltip"),i.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),i.Legend=new qo(i),i.options.paintOnLoad&&t(),!0},this.paint=function(t){function r(e,n,r,o){var a=0;switch(t){case!1:return a=n[r],n[r]+=o,i.domainPosition.setPosition(e,a),a;case i.NAVIGATE_RIGHT:return i.domainPosition.setPosition(e,n[r]),s=o,l=i.domainPosition.getPositionFromIndex(1),i.domainPosition.shiftRightBy(l),n[r];case i.NAVIGATE_LEFT:return a=-o,s=-a,l=n[r]-i.domainPosition.getLast(),i.domainPosition.setPosition(e,a),i.domainPosition.shiftLeftBy(s),a}}function o(t){switch(a.label.rotate){case"right":t.attr("transform",function(t){var n="rotate(90), ";switch(a.label.position){case"right":n+="translate(-"+e(t)+" , -"+e(t)+")";break;case"left":n+="translate(0, -"+i.domainHorizontalLabelWidth+")"}return n});break;case"left":t.attr("transform",function(t){var n="rotate(270), ";switch(a.label.position){case"right":n+="translate(-"+(e(t)+i.domainHorizontalLabelWidth)+" , "+e(t)+")";break;case"left":n+="translate(-"+i.domainHorizontalLabelWidth+" , "+i.domainHorizontalLabelWidth+")"}return n})}}var a=i.options;0===arguments.length&&(t=!1);var u=i.root.select(".graph").selectAll(".graph-domain").data(function(){var e=i.getDomainKeys();return t===i.NAVIGATE_LEFT?e.reverse():e},function(t){return t}),s=0,l=0,c=u.enter().append("svg").attr("width",function(t){return e(t,!0)}).attr("height",function(t){return n(t,!0)}).attr("x",function(t){return a.verticalOrientation?(i.graphDim.width=Math.max(i.graphDim.width,e(t,!0)),0):r(t,i.graphDim,"width",e(t,!0))}).attr("y",function(t){return a.verticalOrientation?r(t,i.graphDim,"height",n(t,!0)):(i.graphDim.height=Math.max(i.graphDim.height,n(t,!0)),0)}).attr("class",function(t){var e="graph-domain",n=new Date(t);switch(a.domain){case"hour":e+=" h_"+n.getHours();case"day":e+=" d_"+n.getDate()+" dy_"+n.getDay();case"week":e+=" w_"+i.getWeekNumber(n);case"month":e+=" m_"+(n.getMonth()+1);case"year":e+=" y_"+n.getFullYear()}return e});i.lastInsertedSvg=c,c.append("rect").attr("width",function(t){
return e(t,!0)-a.domainGutter-a.cellPadding}).attr("height",function(t){return n(t,!0)-a.domainGutter-a.cellPadding}).attr("class","domain-background");var h=c.append("svg").attr("x",function(){return"left"===a.label.position?i.domainHorizontalLabelWidth+a.domainMargin[3]:a.domainMargin[3]}).attr("y",function(){return"top"===a.label.position?i.domainVerticalLabelHeight+a.domainMargin[0]:a.domainMargin[0]}).attr("class","graph-subdomain-group"),f=h.selectAll("g").data(function(t){return i._domains.get(t)}).enter().append("g");f.append("rect").attr("class",function(t){return"graph-rect"+i.getHighlightClassName(t.t)+(null!==a.onClick?" hover_cursor":"")}).attr("width",a.cellSize).attr("height",a.cellSize).attr("x",function(t){return i.positionSubDomainX(t.t)}).attr("y",function(t){return i.positionSubDomainY(t.t)}).on("click",function(t){if(null!==a.onClick)return i.onClick(new Date(t.t),t.v)}).call(function(t){a.cellRadius>0&&t.attr("rx",a.cellRadius).attr("ry",a.cellRadius),null!==i.legendScale&&null!==a.legendColors&&a.legendColors.hasOwnProperty("base")&&t.attr("fill",a.legendColors.base),a.tooltip&&(t.on("mouseover",function(t){var e=this.parentNode.parentNode;i.tooltip.html(i.getSubDomainTitle(t)).attr("style","display: block;");var n=i.positionSubDomainX(t.t)-i.tooltip.node().offsetWidth/2+a.cellSize/2,r=i.positionSubDomainY(t.t)-i.tooltip.node().offsetHeight-a.cellSize/2;n+=parseInt(e.getAttribute("x"),10),r+=parseInt(e.getAttribute("y"),10),n+=parseInt(i.root.select(".graph").attr("x"),10),r+=parseInt(i.root.select(".graph").attr("y"),10),n+=parseInt(e.parentNode.getAttribute("x"),10),r+=parseInt(e.parentNode.getAttribute("y"),10),i.tooltip.attr("style","display: block; left: "+n+"px; top: "+r+"px;")}),t.on("mouseout",function(){i.tooltip.attr("style","display:none").html("")}))}),a.tooltip||f.append("title").text(function(t){return i.formatDate(new Date(t.t),a.subDomainDateFormat)}),""!==a.domainLabelFormat&&c.append("text").attr("class","graph-label").attr("y",function(t){var e=a.domainMargin[0];switch(a.label.position){case"top":e+=i.domainVerticalLabelHeight/2;break;case"bottom":e+=n(t)+i.domainVerticalLabelHeight/2}return e+a.label.offset.y*("right"===a.label.rotate&&"right"===a.label.position||"left"===a.label.rotate&&"left"===a.label.position?-1:1)}).attr("x",function(t){var n=a.domainMargin[3];switch(a.label.position){case"right":n+=e(t);break;case"bottom":case"top":n+=e(t)/2}return"right"===a.label.align?n+i.domainHorizontalLabelWidth-a.label.offset.x*("right"===a.label.rotate?-1:1):n+a.label.offset.x}).attr("text-anchor",function(){switch(a.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return i.verticalDomainLabel?"middle":"top"}).text(function(t){return i.formatDate(new Date(t),a.domainLabelFormat)}).call(o),null!==a.subDomainTextFormat&&f.append("text").attr("class",function(t){return"subdomain-text"+i.getHighlightClassName(t.t)}).attr("x",function(t){return i.positionSubDomainX(t.t)+a.cellSize/2}).attr("y",function(t){return i.positionSubDomainY(t.t)+a.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(t){return i.formatDate(new Date(t.t),a.subDomainTextFormat)}),t!==!1&&u.transition().duration(a.animationDuration).attr("x",function(t){return a.verticalOrientation?0:i.domainPosition.getPosition(t)}).attr("y",function(t){return a.verticalOrientation?i.domainPosition.getPosition(t):0});var g=i.graphDim.width,m=i.graphDim.height;a.verticalOrientation?i.graphDim.height+=s-l:i.graphDim.width+=s-l,u.exit().transition().duration(a.animationDuration).attr("x",function(n){if(a.verticalOrientation)return 0;switch(t){case i.NAVIGATE_LEFT:return Math.min(i.graphDim.width,g);case i.NAVIGATE_RIGHT:return-e(n,!0)}}).attr("y",function(e){if(!a.verticalOrientation)return 0;switch(t){case i.NAVIGATE_LEFT:return Math.min(i.graphDim.height,m);case i.NAVIGATE_RIGHT:return-n(e,!0)}}).remove(),i.resize()}}init(t){function e(t,e,n){if((e&&t===!1||t instanceof Element||"string"==typeof t)&&""!==t)return!0;throw new Error("The "+n+" is not valid")}function n(t){switch(t){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min"}}function r(){if(!c._domainType.hasOwnProperty(h.domain)||"min"===h.domain||"x_"===h.domain.substring(0,2))throw new Error("The domain '"+h.domain+"' is not valid");if(!c._domainType.hasOwnProperty(h.subDomain)||"year"===h.subDomain)throw new Error("The subDomain '"+h.subDomain+"' is not valid");if(c._domainType[h.domain].level<=c._domainType[h.subDomain].level)throw new Error("'"+h.subDomain+"' is not a valid subDomain to '"+h.domain+"'");return!0}function i(){if(!t.hasOwnProperty("label")||t.hasOwnProperty("label")&&!t.label.hasOwnProperty("align")){switch(h.label.position){case"left":h.label.align="right";break;case"right":h.label.align="left";break;default:h.label.align="center"}"left"===h.label.rotate?h.label.align="right":"right"===h.label.rotate&&(h.label.align="left")}(!t.hasOwnProperty("label")||t.hasOwnProperty("label")&&!t.label.hasOwnProperty("offset"))&&("left"!==h.label.position&&"right"!==h.label.position||(h.label.offset={x:10,y:15}))}function o(){switch(h.legendVerticalPosition){case"top":h.legendMargin[2]=c.DEFAULT_LEGEND_MARGIN;break;case"bottom":h.legendMargin[0]=c.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":h.legendMargin["right"===h.legendHorizontalPosition?3:1]=c.DEFAULT_LEGEND_MARGIN}}function a(t){switch("number"==typeof t&&(t=[t]),Array.isArray(t)||(console.log("Margin only takes an integer or an array of integers"),t=[0]),t.length){case 1:return[t[0],t[0],t[0],t[0]];case 2:return[t[0],t[1],t[0],t[1]];case 3:return[t[0],t[1],t[2],t[1]];case 4:return t;default:return t.slice(0,4)}}function u(t){return"string"==typeof t?[t,t+(""!==t?"s":"")]:Array.isArray(t)?1===t.length?[t[0],t[0]+"s"]:t.length>2?t.slice(0,2):t:["item","items"]}function s(t){return t>0?t:null}function l(t){return t>0&&h.colLimit>0?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):t>0?t:null}var c=this,h=c.options=fn(c.options,t);if(r(),e(h.itemSelector,!1,"itemSelector"),c.allowedDataType.indexOf(h.dataType)===-1)throw new Error("The data type '"+h.dataType+"' is not valid data type");if(null===jo(h.itemSelector).node())throw new Error("The node '"+h.itemSelector+"' specified in itemSelector does not exists");try{e(h.nextSelector,!0,"nextSelector"),e(h.previousSelector,!0,"previousSelector")}catch(t){return console.log(t.message),!1}t.hasOwnProperty("subDomain")||(this.options.subDomain=n(t.domain)),"string"==typeof h.itemNamespace&&""!==h.itemNamespace||(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),h.itemNamespace="cal-heatmap");var f=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain"];for(var g in f)t.hasOwnProperty(f[g])&&(h[f[g]]=t[f[g]]);return h.subDomainDateFormat="string"==typeof h.subDomainDateFormat||"function"==typeof h.subDomainDateFormat?h.subDomainDateFormat:this._domainType[h.subDomain].format.date,h.domainLabelFormat="string"==typeof h.domainLabelFormat||"function"==typeof h.domainLabelFormat?h.domainLabelFormat:this._domainType[h.domain].format.legend,h.subDomainTextFormat="string"==typeof h.subDomainTextFormat&&""!==h.subDomainTextFormat||"function"==typeof h.subDomainTextFormat?h.subDomainTextFormat:null,h.domainMargin=a(h.domainMargin),h.legendMargin=a(h.legendMargin),h.highlight=c.expandDateSetting(h.highlight),h.itemName=u(h.itemName),h.colLimit=s(h.colLimit),h.rowLimit=l(h.rowLimit),t.hasOwnProperty("legendMargin")||o(),i(),this._init()}expandDateSetting(t){return Array.isArray(t)||(t=[t]),t.map(function(t){return"now"===t?new Date:t instanceof Date&&t}).filter(function(t){return t!==!1})}fill(t){function e(t){return null!==r.legendScale&&void t.attr("fill",function(t){return null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&!i.considerMissingDataAsZero&&i.legendColors.hasOwnProperty("base")?i.legendColors.base:null!==i.legendColors&&i.legendColors.hasOwnProperty("empty")&&(0===t.v||null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&i.considerMissingDataAsZero)?i.legendColors.empty:t.v<0&&i.legend[0]>0&&null!==i.legendColors&&i.legendColors.hasOwnProperty("overflow")?i.legendColors.overflow:r.legendScale(Math.min(t.v,i.legend[i.legend.length-1]))})}function n(t){"function"==typeof i.subDomainTextFormat&&t.text(function(t){return i.subDomainTextFormat(t.t,t.v)})}var r=this,i=r.options;0===arguments.length&&(t=r.root.selectAll(".graph-domain"));var o=t.selectAll("svg").selectAll("g").data(function(t){return r._domains.get(t)});o.transition().duration(i.animationDuration).select("rect").attr("class",function(t){var e=r.getHighlightClassName(t.t).trim().split(" "),n=r.dateIsLessThan(t.t,new Date),o=r.dateIsEqual(t.t,new Date);return(null===r.legendScale||null===t.v&&i.hasOwnProperty("considerMissingDataAsZero")&&!i.considerMissingDataAsZero&&!i.legendColors.hasOwnProperty("base"))&&e.push("graph-rect"),o?e.push("now"):n||e.push("future"),null!==t.v?e.push(r.Legend.getClass(t.v,null===r.legendScale)):i.considerMissingDataAsZero&&n&&e.push(r.Legend.getClass(0,null===r.legendScale)),null!==i.onClick&&e.push("hover_cursor"),e.join(" ")}).call(e),o.transition().duration(i.animationDuration).select("title").text(function(t){return r.getSubDomainTitle(t)}),o.transition().duration(i.animationDuration).select("text").attr("class",function(t){return"subdomain-text"+r.getHighlightClassName(t.t)}).call(n)}formatStringWithObject(t,e){for(var n in e)if(e.hasOwnProperty(n)){var r=new RegExp("\\{"+n+"\\}","gi");t=t.replace(r,e[n])}return t}triggerEvent(t,e,n){return!!(3===arguments.length&&n||null===this.options[t])||("function"==typeof this.options[t]?("function"==typeof e&&(e=e()),this.options[t].apply(this,e)):(console.log("Provided callback for "+t+" is not a function."),!1))}onClick(t,e){return this.triggerEvent("onClick",[t,e])}afterLoad(){return this.triggerEvent("afterLoad")}onComplete(){var t=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,t}afterLoadPreviousDomain(t){var e=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]})}afterLoadNextDomain(t){var e=this;return this.triggerEvent("afterLoadNextDomain",function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]})}onMinDomainReached(t){return this._minDomainReached=t,this.triggerEvent("onMinDomainReached",[t])}onMaxDomainReached(t){return this._maxDomainReached=t,this.triggerEvent("onMaxDomainReached",[t])}checkIfMinDomainIsReached(t,e){this.minDomainIsReached(t)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(e)&&this.onMaxDomainReached(!1)}checkIfMaxDomainIsReached(t,e){this.maxDomainIsReached(t)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(e)&&this.onMinDomainReached(!1)}formatNumber(){return Un(",g").apply(this,arguments)}formatDate(t,e){if(arguments.length<2&&(e="title"),"function"==typeof e)return e(t);var n=Fi(e);return n(t)}getSubDomainTitle(t){if(null!==t.v||this.options.considerMissingDataAsZero){var e=t.v;return null===e&&this.options.considerMissingDataAsZero&&(e=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(e),name:this.options.itemName[1!==e?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})}return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})}loadNextDomain(t){if(this._maxDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),t));return this.afterLoadNextDomain(e.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),e.start),!0}loadPreviousDomain(t){if(this._minDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-t).reverse());return this.afterLoadPreviousDomain(e.start),this.checkIfMinDomainIsReached(e.start,e.end),!0}loadNewDomains(t,e){function n(t){return{t:r._domainType[r.options.subDomain].extractUnit(t),v:null}}for(var r=this,i=t===this.NAVIGATE_LEFT,o=-1,a=e.length,u=this.getDomainKeys();++o<a;){if(i&&this.minDomainIsReached(e[o])){e=e.slice(0,o+1);break}if(!i&&this.maxDomainIsReached(e[o])){e=e.slice(0,o);break}}for(e=e.slice(-this.options.range),o=0,a=e.length;o<a;o++)this._domains.set(e[o].getTime(),this.getSubDomain(e[o]).map(n)),this._domains.remove(i?u.pop():u.shift());return u=this.getDomainKeys(),i&&(e=e.reverse()),this.paint(t),this.getDatas(this.options.data,e[0],this.getSubDomain(e[e.length-1]).pop(),function(){r.fill(r.lastInsertedSvg)}),{start:e[i?0:1],end:u[u.length-1]}}maxDomainIsReached(t){return null!==this.options.maxDate&&this.options.maxDate.getTime()<t}minDomainIsReached(t){return null!==this.options.minDate&&this.options.minDate.getTime()>=t}getDomainKeys(){return this._domains.keys().map(function(t){return parseInt(t,10)}).sort(function(t,e){return t-e})}positionSubDomainX(t){var e=this._domainType[this.options.subDomain].position.x(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding}positionSubDomainY(t){var e=this._domainType[this.options.subDomain].position.y(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding}getSubDomainColumnNumber(t){if(this.options.rowLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.rowLimit)}var n=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof n&&(n=n(t)),this.options.colLimit||n}getSubDomainRowNumber(t){if(this.options.colLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.colLimit)}var n=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof n&&(n=n(t)),this.options.rowLimit||n}getHighlightClassName(t){if(t=new Date(t),this.options.highlight.length>0)for(var e in this.options.highlight)if(this.dateIsEqual(this.options.highlight[e],t))return this.isNow(this.options.highlight[e])?" highlight-now":" highlight";return""}isNow(t){return this.dateIsEqual(t,new Date)}dateIsEqual(t,e){switch(t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),this.options.subDomain){case"x_min":case"min":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours()&&t.getMinutes()===e.getMinutes();case"x_hour":case"hour":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours();case"x_day":case"day":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();case"x_week":case"week":return t.getFullYear()===e.getFullYear()&&this.getWeekNumber(t)===this.getWeekNumber(e);case"x_month":case"month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}}dateIsLessThan(t,e){function n(t,e){switch(e){case"x_min":case"min":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime();case"x_hour":case"hour":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime();case"x_day":case"day":return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(t.getFullYear(),t.getMonth()).getTime();default:return t.getTime()}}return t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),n(t,this.options.subDomain)<n(e,this.options.subDomain)}getDayOfYear(){return Fi("%j").apply(this,arguments)}getWeekNumber(t){var e=Fi(this.options.weekStartOnMonday===!0?"%W":"%U");return e(t)}getMonthWeekNumber(t){"number"==typeof t&&(t=new Date(t));var e=this.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return this.getWeekNumber(t)-e-1}getWeekNumberInYear(t){"number"==typeof t&&(t=new Date(t))}getDayCountInMonth(t){return this.getEndOfMonth(t).getDate()}getDayCountInYear(t){return"number"==typeof t&&(t=new Date(t)),1===new Date(t.getFullYear(),1,29).getMonth()?366:365}getWeekDay(t){return this.options.weekStartOnMonday===!1?t.getDay():0===t.getDay()?6:t.getDay()-1}getEndOfMonth(t){return"number"==typeof t&&(t=new Date(t)),new Date(t.getFullYear(),t.getMonth()+1,0)}jumpDate(t,e,n){var r=new Date(t);switch(n){case"hour":r.setHours(r.getHours()+e);break;case"day":r.setHours(r.getHours()+24*e);break;case"week":r.setHours(r.getHours()+24*e*7);break;case"month":r.setMonth(r.getMonth()+e);break;case"year":r.setFullYear(r.getFullYear()+e)}return new Date(r)}getMinuteDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),r=null;return r=e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):new Date(+n+1e3*e*60),mi(Math.min(n,r),Math.max(n,r))}getHourDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()),r=null;e instanceof Date?r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):(r=new Date(n),r.setHours(r.getHours()+e));var i=pi(Math.min(n,r),Math.max(n,r)),o=0,a=i.length;for(o=0;o<a;o++)if(o>0&&i[o].getHours()===i[o-1].getHours()){this.DSTDomain.push(i[o].getTime()),i.splice(o,1);break}return"number"==typeof e&&i.length>Math.abs(e)&&i.splice(i.length-1,1),i}getDayDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=null;return e instanceof Date?r=new Date(e.getFullYear(),e.getMonth(),e.getDate()):(r=new Date(n),r=new Date(r.setDate(r.getDate()+parseInt(e,10)))),wi(Math.min(n,r),Math.max(n,r))}getWeekDomain(t,e){var n;this.options.weekStartOnMonday===!1?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()):1===t.getDay()?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()):0===t.getDay()?(n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n.setDate(n.getDate()-6)):n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+1);var r=new Date(n),i=e;return"object"!=typeof e&&(i=new Date(r.setDate(r.getDate()+7*e))),this.options.weekStartOnMonday===!0?Mi(Math.min(n,i),Math.max(n,i)):bi(Math.min(n,i),Math.max(n,i))}getMonthDomain(t,e){var n=new Date(t.getFullYear(),t.getMonth()),r=null;return e instanceof Date?r=new Date(e.getFullYear(),e.getMonth()):(r=new Date(n),r=r.setMonth(r.getMonth()+e)),_i(Math.min(n,r),Math.max(n,r))}getYearDomain(t,e){var n=new Date(t.getFullYear(),0),r=null;return r=e instanceof Date?new Date(e.getFullYear(),0):new Date(t.getFullYear()+e,0),Ni(Math.min(n,r),Math.max(n,r))}getDomain(t,e){switch("number"==typeof t&&(t=new Date(t)),arguments.length<2&&(e=this.options.range),this.options.domain){case"hour":var n=this.getHourDomain(t,e);return"number"==typeof e&&n.length<e&&(e>0?n.push(this.getHourDomain(n[n.length-1],2)[1]):n.shift(this.getHourDomain(n[0],-2)[0])),n;case"day":return this.getDayDomain(t,e);case"week":return this.getWeekDomain(t,e);case"month":return this.getMonthDomain(t,e);case"year":return this.getYearDomain(t,e)}}getSubDomain(t){"number"==typeof t&&(t=new Date(t));var e=this,n=function(t,n){switch(n){case"year":return e.getDayCountInYear(t);case"month":return e.getDayCountInMonth(t);case"week":return 7}},r=function(t,e){switch(e){case"hour":return 60;case"day":return 1440;case"week":return 10080}},i=function(t,n){switch(n){case"day":return 24;case"week":return 168;case"month":return 24*e.getDayCountInMonth(t)}},o=function(t,n){if("month"===n){var r=new Date(t.getFullYear(),t.getMonth()+1,0),i=e.getWeekNumber(r),o=e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return o>i&&(o=0,i++),i-o+1}if("year"===n)return e.getWeekNumber(new Date(t.getFullYear(),11,31))};switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(t,r(t,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(t,i(t,this.options.domain));case"x_day":case"day":return this.getDayDomain(t,n(t,this.options.domain));case"x_week":case"week":return this.getWeekDomain(t,o(t,this.options.domain));case"x_month":case"month":return this.getMonthDomain(t,12)}}getNextDomain(t){return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),t,this.options.domain),1)[0]}getPreviousDomain(t){return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-t,this.options.domain),1)[0]}getDatas(t,e,n,r,i,o){var a=this;arguments.length<5&&(i=!0),arguments.length<6&&(o=this.APPEND_ON_UPDATE);var u=function(t){i!==!1?"function"==typeof i?t=i(t):"function"==typeof a.options.afterLoadData?t=a.options.afterLoadData(t):console.log("Provided callback for afterLoadData is not a function."):"csv"!==a.options.dataType&&"tsv"!==a.options.dataType||(t=this.interpretCSV(t)),a.parseDatas(t,o,e,n),"function"==typeof r&&r()};switch(typeof t){case"string":if(""===t)return u({}),!0;var s=this.parseURI(t,e,n),l="GET";null!==a.options.dataPostPayload&&(l="POST");var c=null;switch(null!==a.options.dataPostPayload&&(c=this.parseURI(a.options.dataPostPayload,e,n)),this.options.dataType){case"json":zr(s,u).send(l,c);break;case"csv":Xr(s,u).send(l,c);break;case"tsv":$r(s,u).send(l,c);break;case"txt":Wr(s,u).send(l,c)}return!1;case"object":if(t===Object(t))return u(t),!1;default:return u({}),!0}}parseDatas(t,e,n,r){e===this.RESET_ALL_ON_UPDATE&&this._domains.forEach(function(t,e){e.forEach(function(t,e,n){n[e].v=null})});var i={},o=function(t){return t.t};for(var a in t){var u=new Date(1e3*a),s=this.getDomain(u)[0].getTime();if(this.DSTDomain.indexOf(s)>=0&&this._domains.has(s-36e5)&&(s-=36e5),!isNaN(a)&&t.hasOwnProperty(a)&&this._domains.has(s)&&s>=+n&&s<+r){var l=this._domains.get(s);i.hasOwnProperty(s)||(i[s]=l.map(o));var c=i[s].indexOf(this._domainType[this.options.subDomain].extractUnit(u));e===this.RESET_SINGLE_ON_UPDATE?l[c].v=t[a]:isNaN(l[c].v)?l[c].v=t[a]:l[c].v+=t[a]}}}parseURI(t,e,n){return t=t.replace(/\{\{t:start\}\}/g,e.getTime()/1e3),t=t.replace(/\{\{t:end\}\}/g,n.getTime()/1e3),t=t.replace(/\{\{d:start\}\}/g,e.toISOString()),t=t.replace(/\{\{d:end\}\}/g,n.toISOString())}interpretCSV(t){var e,n,r={},i=Object.keys(t[0]);for(e=0,n=t.length;e<n;e++)r[t[e][i[0]]]=+t[e][i[1]];return r}resize(){var t=this,e=t.options,n=e.displayLegend?t.Legend.getDim("width")+e.legendMargin[1]+e.legendMargin[3]:0,r=e.displayLegend?t.Legend.getDim("height")+e.legendMargin[0]+e.legendMargin[2]:0,i=t.graphDim.width-e.domainGutter-e.cellPadding,o=t.graphDim.height-e.domainGutter-e.cellPadding;this.root.transition().duration(e.animationDuration).attr("width",function(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?i+n:Math.max(i,n)}).attr("height",function(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?Math.max(o,r):o+r}),this.root.select(".graph").transition().duration(e.animationDuration).attr("y",function(){return"top"===e.legendVerticalPosition?r:0}).attr("x",function(){return"middle"!==e.legendVerticalPosition&&"center"!==e.legendVerticalPosition||"left"!==e.legendHorizontalPosition?0:n})}next(t){return 0===arguments.length&&(t=1),this.loadNextDomain(t)}previous(t){return 0===arguments.length&&(t=1),this.loadPreviousDomain(t)}jumpTo(t,e){arguments.length<2&&(e=!1);var n=this.getDomainKeys(),r=n[0],i=n[n.length-1];return t<r?this.loadPreviousDomain(this.getDomain(r,t).length):e?this.loadNextDomain(this.getDomain(r,t).length):t>i&&this.loadNextDomain(this.getDomain(i,t).length)}rewind(){this.jumpTo(this.options.start,!0)}update(t,e,n){arguments.length<2&&(e=!0),arguments.length<3&&(n=this.RESET_ALL_ON_UPDATE);var r=this.getDomainKeys(),i=this;this.getDatas(t,new Date(r[0]),this.getSubDomain(r[r.length-1]).pop(),function(){i.fill()},e,n)}setLegend(){var t=this.options.legend.slice(0);arguments.length>=1&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),arguments.length>=2&&(Array.isArray(arguments[1])&&arguments[1].length>=2?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(arguments.length>0&&!gn(t,this.options.legend)||arguments.length>=2)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)}removeLegend(){return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)}showLegend(){return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)}highlight(t){return(this.options.highlight=this.expandDateSetting(t)).length>0&&(this.fill(),!0)}destroy(t){return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each(function(){"function"==typeof t?t():"undefined"!=typeof t&&console.log("Provided callback for destroy() is not a function.")}),null}getSVG(){for(var t={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},e=1,n=this.options.legend.length+1;e<=n;e++)t[".q"+e]={};var r=this.root,i=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],o=function(e,n,r){i.indexOf(n)!==-1&&(t[e][n]=r)},a=function(t){return r.select(t).node()};for(var u in t)if(t.hasOwnProperty(u)){var s=a(u);if(null!==s)if("getComputedStyle"in window){var l=getComputedStyle(s,null);if(0!==l.length)for(var c=0;c<l.length;c++)o(u,l.item(c),l.getPropertyValue(l.item(c)));else for(var h in l)l.hasOwnProperty(h)&&o(u,h,l[h])}else if("currentStyle"in s){var f=s.currentStyle;for(var g in f)o(u,g,f[g])}}var m='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var d in t){m+=d+" {\n";for(var p in t[d])m+="\t"+p+":"+t[d][p]+";\n";m+="}\n"}return m+="]]></style>",m+=(new XMLSerializer).serializeToString(this.root.node()),m+="</svg>"}}class Vo{constructor(){this.positions=r()}getPosition(t){return this.positions.get(t)}getPositionFromIndex(t){var e=this.getKeys();return this.positions.get(e[t])}getLast(){var t=this.getKeys();return this.positions.get(t[t.length-1])}setPosition(t,e){this.positions.set(t,e)}shiftRightBy(t){this.positions.each(function(e,n,r){r.set(e,n-t)});var e=this.getKeys();this.positions.remove(e[0])}shiftLeftBy(t){this.positions.each(function(e,n,r){r.set(e,n+t)});var e=this.getKeys();this.positions.remove(e[e.length-1])}getKeys(){return this.positions.keys().sort(function(t,e){return parseInt(t,10)-parseInt(e,10)})}}class qo{constructor(t){this.calendar=t,this.computeDim(),null!==t.options.legendColors&&this.buildColors()}computeDim(){var t=this.calendar.options;this.dim={width:t.legendCellSize*(t.legend.length+1)+t.legendCellPadding*t.legend.length,height:t.legendCellSize}}remove(){this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()}redraw(t){function e(t){t.attr("width",s.legendCellSize).attr("height",s.legendCellSize).attr("x",function(t,e){return e*(s.legendCellSize+s.legendCellPadding)})}function n(){switch(s.legendHorizontalPosition){case"right":return"center"===s.legendVerticalPosition||"middle"===s.legendVerticalPosition?t+s.legendMargin[3]:t-o.getDim("width")-s.legendMargin[1];case"middle":case"center":return Math.round(t/2-o.getDim("width")/2);default:return s.legendMargin[3]}}function r(){return"bottom"===s.legendVerticalPosition?a.graphDim.height+s.legendMargin[0]-s.domainGutter-s.cellPadding:s.legendMargin[0]}if(!this.calendar.options.displayLegend)return!1;var i,o=this,a=this.calendar,u=a.root,s=a.options;this.computeDim();var l=s.legend.slice(0);l.push(l[l.length-1]+1);var c=a.root.select(".graph-legend");null!==c.node()?(u=c,i=u.select("g").selectAll("rect").data(l)):(u="top"===s.legendVerticalPosition?u.insert("svg",".graph"):u.append("svg"),u.attr("x",n()).attr("y",r()),i=u.attr("class","graph-legend").attr("height",o.getDim("height")).attr("width",o.getDim("width")).append("g").selectAll().data(l)),i.enter().append("rect").call(e).attr("class",function(t){return a.Legend.getClass(t,null===a.legendScale)}).attr("fill-opacity",0).call(function(t){null!==a.legendScale&&null!==s.legendColors&&s.legendColors.hasOwnProperty("base")&&t.attr("fill",s.legendColors.base)}).append("title"),i.exit().transition().duration(s.animationDuration).attr("fill-opacity",0).remove(),i.transition().delay(function(t,e){return s.animationDuration*e/10}).call(e).attr("fill-opacity",1).call(function(t){t.attr("fill",function(t,e){return null===a.legendScale?"":0===e?a.legendScale(t-1):a.legendScale(s.legend[e-1])}),t.attr("class",function(t){return a.Legend.getClass(t,null===a.legendScale)})}),i.select("title").text(function(t,e){return 0===e?a.formatStringWithObject(s.legendTitleFormat.lower,{min:s.legend[e],name:s.itemName[1]}):e===l.length-1?a.formatStringWithObject(s.legendTitleFormat.upper,{max:s.legend[e-1],name:s.itemName[1]}):a.formatStringWithObject(s.legendTitleFormat.inner,{down:s.legend[e-1],up:s.legend[e],name:s.itemName[1]})}),u.transition().duration(s.animationDuration).attr("x",n()).attr("y",r()).attr("width",o.getDim("width")).attr("height",o.getDim("height")),u.select("g").transition().duration(s.animationDuration).attr("transform",function(){return"vertical"===s.legendOrientation?"rotate(90 "+s.legendCellSize/2+" "+s.legendCellSize/2+")":""}),a.resize()}getDim(t){var e="horizontal"===this.calendar.options.legendOrientation;switch(t){case"width":return this.dim[e?"width":"height"];case"height":return this.dim[e?"height":"width"]}}buildColors(){var t=this.calendar.options;if(null===t.legendColors)return this.calendar.legendScale=null,!1;var e=[];if(Array.isArray(t.legendColors))e=t.legendColors;else{if(!t.legendColors.hasOwnProperty("min")||!t.legendColors.hasOwnProperty("max"))return t.legendColors=null,!1;e=[t.legendColors.min,t.legendColors.max]}var n=t.legend.slice(0);n[0]>0?n.unshift(0):n[0]<0&&n.unshift(n[0]-(n[n.length-1]-n[0])/n.length);var r=lt().range(e).interpolate(Or).domain([Tn(n),_n(n)]),i=n.map(function(t){return r(t)});return this.calendar.legendScale=ct().domain(t.legend).range(i),!0}getClass(t,e){if(null===t||isNaN(t))return"";for(var n=[this.calendar.options.legend.length+1],r=0,i=this.calendar.options.legend.length-1;r<=i;r++){if(this.calendar.options.legend[0]>0&&t<0){n=["1","i"];break}if(t<=this.calendar.options.legend[r]){n=[r+1];break}}return 0===t&&n.push(0),n.unshift(""),(n.join(" r")+(e?n.join(" q"):"")).trim()}}return Go});
//# sourceMappingURL=cal-heatmap.umd.full.min.js.map
